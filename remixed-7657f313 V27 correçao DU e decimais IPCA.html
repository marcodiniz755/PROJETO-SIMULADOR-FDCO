<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador FDCO - SUDECO (Resolu√ß√£o 4960)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <style>
        /* Font Awesome Icons - Fallback interno */
        @font-face {
            font-family: 'FontAwesome';
            src: url('data:font/woff2;base64,') format('woff2');
            font-weight: normal;
            font-style: normal;
        }
        
        /* √çcones usando Unicode como fallback */
        .fa-calculator:before, .fas.fa-calculator:before { content: "üßÆ"; }
        .fa-refresh:before, .fas.fa-refresh:before { content: "üîÑ"; }
        .fa-chart-bar:before, .fas.fa-chart-bar:before { content: "üìä"; }
        .fa-chevron-down:before, .fas.fa-chevron-down:before { content: "‚ñº"; }
        .fa-function:before, .fas.fa-function:before { content: "∆í"; }
        .fa-tags:before, .fas.fa-tags:before { content: "üè∑Ô∏è"; }
        .fa-chart-line:before, .fas.fa-chart-line:before { content: "üìà"; }
        .fa-check-circle:before, .fas.fa-check-circle:before { content: "‚úÖ"; }
        .fa-exclamation-triangle:before, .fas.fa-exclamation-triangle:before { content: "‚ö†Ô∏è"; }
        .fa-times-circle:before, .fas.fa-times-circle:before { content: "‚ùå"; }
        .fa-info-circle:before, .fas.fa-info-circle:before { content: "‚ÑπÔ∏è"; }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .header-logo svg {
            width: 300px;
            height: 162px;
        }

        .header-content h1 {
            color: #2c3e50;
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .header-content p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .parameters-collapsible {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }

        .parameters-header {
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(45deg, #2c3e50, #3498db);
            color: white;
        }

        .parameters-title {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .formula-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-family: 'Courier New', monospace;
        }

        .parameters-toggle {
            transition: transform 0.3s ease;
        }

        .parameters-toggle.expanded {
            transform: rotate(180deg);
        }

        .parameters-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .parameters-content.expanded {
            max-height: 800px;
        }

        .parameters-horizontal {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .parameter-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #3498db;
        }

        .parameter-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .parameter-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: #27ae60;
            margin-bottom: 10px;
        }

        .parameter-description {
            font-size: 0.9rem;
            color: #7f8c8d;
            line-height: 1.4;
        }

        .projeto-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .panel-title {
            font-size: 1.5rem;
            color: #2c3e50;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .projeto-horizontal {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .projeto-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border-top: 4px solid #3498db;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group.required label::after {
            content: ' *';
            color: #e74c3c;
            font-weight: bold;
            font-size: 1.1rem;
        }

        /* √çcones Font Awesome - Sistema de fallback completo */
        .fas, .fa-solid, .fa {
            font-family: "FontAwesome", "Font Awesome 6 Free", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol" !important;
            font-weight: 900 !important;
            font-style: normal !important;
            display: inline-block !important;
            text-rendering: auto;
            -webkit-font-smoothing: antialiased;
        }

        /* Fallback para √≠cones espec√≠ficos usando emojis */
        .icon-fallback {
            display: inline-block;
            width: 1em;
            text-align: center;
            margin-right: 0.5em;
            font-family: "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
        }

        /* Estados dos campos obrigat√≥rios */
        .form-group.required input,
        .form-group.required select {
            border-left: 4px solid #e74c3c; /* Padr√£o: vermelho */
        }

        .form-group.required input:valid:not(:placeholder-shown),
        .form-group.required select:valid:not([value=""]) {
            border-left: 4px solid #27ae60; /* Preenchido: verde */
        }

        /* Estados de foco - sempre azul quando selecionado */
        .form-group.required input:focus,
        .form-group.required select:focus {
            border-left-color: #3498db !important; /* Foco: azul */
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1) !important;
        }

        /* Para campos com input-group */
        .form-group.required .input-group input {
            border-left: 4px solid #e74c3c;
        }

        .form-group.required .input-group input:valid:not(:placeholder-shown) {
            border-left: 4px solid #27ae60;
        }

        .form-group.required .input-group input:focus {
            border-left-color: #3498db !important;
        }

        .form-group.error {
            border-left: 3px solid #e74c3c;
            padding-left: 10px;
        }

        .form-group.success {
            border-left: 3px solid #27ae60;
            padding-left: 10px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-group.required .input-group input:invalid,
        .form-group.required .input-group input:placeholder-shown {
            border-left: 4px solid #e74c3c;
            border-radius: 0 8px 8px 0;
        }

        .form-group.required .input-group input:valid:not(:placeholder-shown) {
            border-left: 4px solid #27ae60;
            border-radius: 0 8px 8px 0;
        }

        .form-group.required .input-group input:focus {
            border-left-color: #3498db !important;
        }

        .input-group {
            display: flex;
        }

        .input-prefix {
            background: #e9ecef;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-right: none;
            border-radius: 8px 0 0 8px;
            font-weight: 500;
        }

        .input-group input {
            border-radius: 0 8px 8px 0;
            border-left: none;
        }

        .btn-primary, .btn-secondary {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
            width: 100%;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
            transform: translateY(-2px);
        }

        .results-panel-fullwidth {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .results-placeholder {
            text-align: center;
            padding: 60px 20px;
            color: #7f8c8d;
        }

        .placeholder-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #bdc3c7;
        }

        .results-title-full {
            font-size: 1.8rem;
            color: #2c3e50;
            margin-bottom: 30px;
            text-align: center;
        }

        .placeholder-steps {
            display: grid;
            gap: 15px;
            max-width: 500px;
            margin: 0 auto 30px;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 15px;
            text-align: left;
        }

        .step-number {
            background: #3498db;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .results-horizontal {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .results-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border-top: 4px solid #27ae60;
        }

        .results-card-title {
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .highlight-result-large {
            text-align: center;
        }

        .value-large {
            font-size: 2.5rem;
            font-weight: 700;
            color: #27ae60;
            display: block;
            margin-bottom: 10px;
        }

        .label-large {
            font-size: 1.1rem;
            color: #2c3e50;
            font-weight: 500;
        }

        .result-item-large {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .result-item-large:last-child {
            border-bottom: none;
        }

        .result-label-large {
            font-weight: 500;
            color: #2c3e50;
        }

        .result-value-large {
            font-weight: 600;
            color: #27ae60;
            font-size: 1.1rem;
        }

        .schedule-section {
            margin-top: 30px;
        }

        .schedule-title {
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .payment-schedule-large table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .payment-schedule-large th {
            background: #2c3e50;
            color: white;
            padding: 15px 10px;
            text-align: left;
            font-weight: 600;
        }

        .payment-schedule-large td {
            padding: 12px 10px;
            border-bottom: 1px solid #ecf0f1;
        }

        .payment-schedule-large tr:hover {
            background: #f8f9fa;
        }

        .grace-period {
            background: #fff3cd !important;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }

        .error-message {
            color: #e74c3c;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header {
                flex-direction: column;
                text-align: center;
            }
            
            .projeto-horizontal, .results-horizontal, .parameters-horizontal {
                grid-template-columns: 1fr;
            }
            
            .header-content h1 {
                font-size: 1.5rem;
            }
            
            .value-large {
                font-size: 2rem;
            }
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #2c3e50;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            font-size: 0.8rem;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-logo">
                <svg width="380" height="162" viewBox="0 0 950 300">
                    <!-- Logo SUDECO oficial baseada na imagem fornecida -->
                    <!-- Ret√¢ngulo verde superior esquerdo -->
                    <rect x="50" y="50" width="140" height="90" rx="20" fill="#00B04F" />
                    
                    <!-- Ret√¢ngulo amarelo superior direito -->
                    <rect x="210" y="50" width="140" height="90" rx="20" fill="#FFD500" />
                    
                    <!-- Ret√¢ngulo azul inferior esquerdo -->
                    <rect x="50" y="160" width="140" height="90" rx="20" fill="#003F7F" />
                    
                    <!-- Ret√¢ngulo vermelho central -->
                    <rect x="170" y="120" width="60" height="60" rx="8" fill="#E30613" />
                    
                    <!-- Texto SUDECO - come√ßando embaixo do quadrado vermelho -->
                    <text x="240" y="190" font-family="Arial Black, Arial, sans-serif" font-size="56" font-weight="900" fill="#4A4A4A" text-anchor="left">SUDECO</text>
                    
                    <!-- Texto descritivo - maior, leg√≠vel e em negrito -->
                    <text x="50" y="270" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#666" text-anchor="left">SUPERINTEND√äNCIA DO DESENVOLVIMENTO DO CENTRO-OESTE</text>
                </svg>
            </div>
            <div class="header-content">
                <h1><span class="icon-fallback">üèõÔ∏è</span> Simulador FDCO</h1>
                <p>Fundo de Desenvolvimento do Centro-Oeste</p>
                <div style="margin-top: 10px; padding: 8px 12px; background: #e7f3ff; border-radius: 6px; font-size: 0.9rem; color: #1976d2;">
                    Data: <span id="current-date">01/08/2025</span> | Vers√£o: 2.1.2
                </div>
            </div>
        </header>

        <div class="parameters-collapsible">
            <div class="parameters-header" onclick="toggleParameters()">
                <div class="parameters-title">
                    üìä F√≥rmulas e Par√¢metros
                    <span class="formula-badge">TFD = FAM √ó [1 + (CDR √ó FP √ó TLP)]^(DU/252) - 1</span>
                </div>
                <div class="parameters-toggle" id="parametersToggle">
                    ‚ñº
                </div>
            </div>
            
            <div class="parameters-content" id="parametersContent">
                <div class="parameters-horizontal" style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px;">
                    <div class="parameter-card">
                        <h4 style="font-size: 0.9rem;"><i class="fas fa-function"></i> TFD - F√≥rmula Principal</h4>
                        <div class="parameter-value" style="font-size: 0.75rem;">TFD = FAM √ó [1 + (CDR √ó FP √ó TLP)]^(DU/252) - 1</div>
                        <div class="parameter-description" style="font-size: 0.75rem; line-height: 1.3;">
                            <strong>FAM:</strong> Fator de Atualiza√ß√£o Monet√°ria<br>
                            <strong>CDR:</strong> Coeficiente de Desequil√≠brio Regional (1,00)<br>
                            <strong>FP:</strong> Fator de Programa (A/B/C/D)<br>
                            <strong>TLP:</strong> Taxa de Longo Prazo<br>
                            <strong>DU:</strong> Dias √öteis (252 base anual)
                        </div>
                    </div>
                    
                    <div class="parameter-card">
                        <h4 style="font-size: 0.9rem;"><i class="fas fa-calculator"></i> FAM - Fator de Atualiza√ß√£o</h4>
                        <div class="parameter-value" style="font-size: 0.7rem;">FAM = (1 + œÄm-2)^(ndup/ndmp) √ó (1 + œÄm-1)^(ndus/ndms)</div>
                        <div class="parameter-description" style="font-size: 0.75rem; line-height: 1.3;">
                            <strong>œÄm-1:</strong> IPCA m√™s anterior = <span id="ipca-m1-display">0,24%</span><br>
                            <strong>œÄm-2:</strong> IPCA m√™s retrasado = <span id="ipca-m2-display">0,26%</span><br>
                            <strong>ndup/ndus:</strong> Dias √∫teis = <span id="ndup-display">10</span>/<span id="ndus-display">13</span><br>
                            <strong>ndmp/ndms:</strong> Dias totais = <span id="ndmp-display">21</span>/<span id="ndms-display">23</span>
                        </div>
                    </div>
                    
                    <div class="parameter-card">
                        <h4 style="font-size: 0.9rem;"><i class="fas fa-chart-line"></i> TLP - Taxa de Longo Prazo</h4>
                        <div class="parameter-value" id="param-tlp">7,51% a.a.</div>
                        <div class="parameter-description" style="font-size: 0.75rem; line-height: 1.3;">
                            Taxa oficial do BACEN, definida conforme metodologia do BNDES. Atualizada automaticamente via API oficial do Banco Central.
                            <br><strong>Fonte:</strong> API BCB - S√©rie 27572
                            <div id="last-update-indicator" style="margin-top: 8px;"></div>
                        </div>
                    </div>
                    
                    <div class="parameter-card">
                        <h4 style="font-size: 0.9rem;"><i class="fas fa-tags"></i> Fatores de Programa (FP)</h4>
                        <div class="parameter-value" style="font-size: 0.75rem; line-height: 1.2;">A(0,85) | B(1,05) | C(1,25) | D(1,45)</div>
                        <div class="parameter-description" style="font-size: 0.75rem; line-height: 1.3;">
                            <strong>A (0,85):</strong> Saneamento - PRIORIT√ÅRIA<br>
                            <strong>B (1,05):</strong> Demais setores - PRIORIT√ÅRIA<br>
                            <strong>C (1,25):</strong> Saneamento - DEMAIS<br>
                            <strong>D (1,45):</strong> Demais setores - DEMAIS
                        </div>
                    </div>

                    <div class="parameter-card" style="border-left: 4px solid #f39c12;">
                        <h4 style="font-size: 0.9rem;"><i class="fas fa-sync-alt"></i> Atualiza√ß√£o de Taxas</h4>
                        <div class="parameter-description" style="text-align: center;">
                            <p style="margin-bottom: 10px; color: #7f8c8d; font-size: 0.75rem; line-height: 1.2;">
                                APIs bloqueadas pelo ambiente. Use atualiza√ß√£o manual:
                            </p>
                            <button onclick="updateRatesManually()" style="background: #f39c12; color: white; border: none; padding: 8px 12px; border-radius: 6px; font-size: 0.75rem; cursor: pointer; width: 100%; transition: all 0.3s ease; font-weight: 600;">
                                üîÑ Atualizar Taxas
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="projeto-panel">
            <h2 class="panel-title">‚öôÔ∏è Dados do Projeto</h2>
            <form id="simulatorForm">
                <div class="projeto-horizontal">
                    <div class="projeto-card">
                        <div class="section-title">
                            üìç Localiza√ß√£o e Tipo
                        </div>
                        <div class="form-group required">
                            <label for="state">
                                <span class="icon-fallback">üèõÔ∏è</span> Estado
                            </label>
                            <select id="state">
                                <option value="">Selecione</option>
                                <option value="DF">Distrito Federal</option>
                                <option value="GO">Goi√°s</option>
                                <option value="MT">Mato Grosso</option>
                                <option value="MS">Mato Grosso do Sul</option>
                            </select>
                        </div>
                        <div class="form-group required">
                            <label for="municipality">
                                <span class="icon-fallback">üèôÔ∏è</span> Munic√≠pio
                            </label>
                            <select id="municipality">
                                <option value="">Selecione o estado primeiro</option>
                            </select>
                        </div>
                        <div class="form-group required">
                            <label for="projectSector">
                                <span class="icon-fallback">üíº</span> Setor do Projeto
                            </label>
                            <select id="projectSector">
                                <option value="">Selecione o setor</option>
                                <optgroup label="üèóÔ∏è INFRAESTRUTURA - SANEAMENTO (FP: A/C - at√© 20 anos)">
                                    <option value="infraestrutura_saneamento_III">Saneamento B√°sico - Abastecimento de √Ågua e Esgotamento Sanit√°rio</option>
                                </optgroup>
                                <optgroup label="üöõ INFRAESTRUTURA (FP: B/D - at√© 20 anos)">
                                    <option value="infraestrutura_transportes_I">Transportes: Rodovias, Ferrovias, Hidrovias e Aeroportos</option>
                                    <option value="infraestrutura_armazenagem_II">Armazenagem - Unidades Coletora, Intermedi√°ria e Terminal</option>
                                    <option value="infraestrutura_residuos_IV">Usinas de Compostagem/Aterros Sanit√°rios e Tratamento de Res√≠duos</option>
                                    <option value="infraestrutura_gas_V">Produ√ß√£o e Distribui√ß√£o de G√°s e Gasoduto</option>
                                    <option value="infraestrutura_petroleo_VI">Produ√ß√£o, Refino e Distribui√ß√£o de Petr√≥leo e Biocombust√≠veis</option>
                                    <option value="infraestrutura_logistica_VII">Atividades de Log√≠stica - Armazenagem e Centros de Distribui√ß√£o</option>
                                    <option value="infraestrutura_telecomunicacoes_VIII">Telecomunica√ß√µes</option>
                                    <option value="infraestrutura_energia_X">Gera√ß√£o, Transmiss√£o e Distribui√ß√£o de Energia</option>
                                    <option value="infraestrutura_urbana_XI">Infraestrutura Urbana - Centros Administrativos P√∫blicos</option>
                                    <option value="infraestrutura_portuaria_IX">Infraestrutura Portu√°ria e Aeroportu√°ria, Inclusive Portos Secos</option>
                                </optgroup>
                                <optgroup label="üõ≥Ô∏è INFRAESTRUTURA ESTRUTURANTE (FP: B/D - at√© 20 anos)">
                                    <option value="infraestrutura_estruturador">Estruturador</option>
                                </optgroup>
                                <optgroup label="üèõÔ∏è SERVI√áOS P√öBLICOS (FP: B/D - at√© 12 anos)">
                                    <option value="servicos_publicos">Servi√ßos P√∫blicos</option>
                                </optgroup>
                                <optgroup label="üè® SERVI√áOS (FP: B/D - at√© 12 anos)">
                                    <option value="servicos_turismo_I">Turismo - Empreendimentos Hoteleiros e Centros de Conven√ß√µes</option>
                                    <option value="servicos_hospitalares_II">Servi√ßos Hospitalares, Ambulatoriais e de Diagn√≥sticos</option>
                                    <option value="servicos_transporte_passageiros_III">Transporte Regional de Passageiros</option>
                                    <option value="servicos_educacionais_IV">Empreendimentos Educacionais e Profissionalizantes</option>
                                </optgroup>
                                <optgroup label="üåæ TRADICIONAIS (FP: B/D - at√© 12 anos)">
                                    <option value="tradicionais_agricultura_I">Agricultura, Agroneg√≥cio, Fruticultura e Florestamento</option>
                                    <option value="tradicionais_veiculos_II">Cadeia Produtiva de Ve√≠culos Automotores</option>
                                    <option value="tradicionais_couros_III_a">Ind√∫stria - Couros, Peles, Cal√ßados e Artefatos</option>
                                    <option value="tradicionais_plasticos_III_b">Ind√∫stria - Pl√°sticos e Seus Derivados</option>
                                    <option value="tradicionais_latex_III_c">Ind√∫stria - L√°tex e Seus Derivados</option>
                                    <option value="tradicionais_textil_III_d">Ind√∫stria - T√™xtil e Artigos de Vestu√°rio</option>
                                    <option value="tradicionais_maquinas_III_e">Ind√∫stria - M√°quinas, Ferramentas e Automa√ß√£o Industrial</option>
                                    <option value="tradicionais_minerais_III_f">Ind√∫stria - Minerais, Metalurgia, Siderurgia e Mec√¢nica</option>
                                    <option value="tradicionais_quimicos_III_g">Ind√∫stria - Qu√≠micos e Petroqu√≠micos</option>
                                    <option value="tradicionais_moveis_madeira_III_h">Ind√∫stria - M√≥veis e Artefatos de Madeira Sustent√°vel</option>
                                    <option value="tradicionais_alimentos_III_i">Ind√∫stria - Alimentos, Carnes e Bebidas</option>
                                    <option value="tradicionais_embalagens_III_j">Ind√∫stria - Fabrica√ß√£o de Embalagens</option>
                                    <option value="tradicionais_cimento_III_k">Ind√∫stria - Cimento e Materiais de Constru√ß√£o</option>
                                    <option value="tradicionais_reciclagem_III_l">Ind√∫stria - Reciclagem de Papel, Pl√°stico e Metais</option>
                                    <option value="tradicionais_papel_III_m">Ind√∫stria - Papel, Papel√£o e Celulose Sustent√°vel</option>
                                    <option value="tradicionais_mineracao_IV">Extra√ß√£o e Beneficiamento de Minerais</option>
                                    <option value="tradicionais_agroindustria_V">Agroind√∫stria</option>
                                    <option value="tradicionais_apicultura_VI">Apicultura</option>
                                    <option value="tradicionais_laticinios_VII">Latic√≠nios</option>
                                    <option value="tradicionais_agropecuaria_VIII">Agropecu√°ria em √Åreas de Voca√ß√£o</option>
                                    <option value="tradicionais_aquicultura_IX">Aquicultura, Pesca e Beneficiamento de Pescado</option>
                                    <option value="tradicionais_suinocultura_X">Suinocultura e Avicultura</option>
                                    <option value="tradicionais_lavoura_pecuaria_XI">Projeto Integrado Lavoura-Pecu√°ria-Floresta</option>
                                </optgroup>
                                <optgroup label="üî¨ CI√äNCIA, TECNOLOGIA E INOVA√á√ÉO (FP: B/D - at√© 12 anos)">
                                    <option value="cti_biotecnologia_I">Biotecnologia</option>
                                    <option value="cti_telecomunicacoes_II">Telecomunica√ß√µes</option>
                                    <option value="cti_nanotecnologia_III">Nanotecnologia</option>
                                    <option value="cti_geotecnologia_IV">Geotecnologia</option>
                                    <option value="cti_mecatronica_V">Mecatr√¥nica</option>
                                    <option value="cti_tic_VI">Tecnologias da Informa√ß√£o e Comunica√ß√£o (TIC)</option>
                                    <option value="cti_equipamentos_medicos_VII">Equipamentos M√©dico-Hospitalares e Instrumentos de Precis√£o</option>
                                    <option value="cti_industria_4_VIII">Internet das Coisas, Ind√∫stria 4.0 e Cidades Inteligentes</option>
                                    <option value="cti_farmaco_IX">F√°rmaco-Cosm√©tico-Qu√≠mica</option>
                                    <option value="cti_biocombustiveis_X">Biocombust√≠veis</option>
                                    <option value="cti_energia_renovavel_XI">Energia Renov√°vel e Moderniza√ß√£o da Matriz Energ√©tica</option>
                                    <option value="cti_petroleo_gas_XII">Petr√≥leo, G√°s e Carv√£o Mineral</option>
                                    <option value="cti_bioeconomia_XIII">Bioeconomia e Descarboniza√ß√£o</option>
                                    <option value="cti_meteorologia_XIV">Meteorologia e Mudan√ßas Clim√°ticas</option>
                                    <option value="cti_aeronautico_XV">Programa Aeron√°utico e Espacial</option>
                                    <option value="cti_nuclear_XVI">Programa Nuclear</option>
                                    <option value="cti_defesa_XVII">Defesa Nacional e Seguran√ßa P√∫blica</option>
                                    <option value="cti_industria_defesa_XVIII">Ind√∫stria de Defesa</option>
                                    <option value="cti_agro_digital_XIX">Cadeias Agroindustriais Sustent√°veis e Digitais</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>

                    <div class="projeto-card">
                        <div class="section-title">
                            üí∞ Dados Financeiros
                        </div>
                        <div class="form-group required">
                            <label for="totalInvestment">
                                <span class="icon-fallback">üìà</span> Investimento Total
                            </label>
                            <div class="input-group">
                                <span class="input-prefix">R$</span>
                                <input type="text" id="totalInvestment" placeholder="20.000.000,00" inputmode="numeric">
                            </div>
                            <div id="totalInvestmentHint" style="font-size: 0.8rem; color: #7f8c8d; margin-top: 5px;"></div>
                        </div>
                        <div class="form-group required">
                            <label for="fixedInvestment">
                                <span class="icon-fallback">üî®</span> Investimento Fixo
                            </label>
                            <div class="input-group">
                                <span class="input-prefix">R$</span>
                                <input type="text" id="fixedInvestment" placeholder="16.000.000,00" inputmode="numeric">
                            </div>
                            <div id="fixedInvestmentHint" style="font-size: 0.8rem; color: #7f8c8d; margin-top: 5px;"></div>
                        </div>
                        <div class="form-group">
                            <label for="ownResources">
                                <span class="icon-fallback">üí∞</span> Recursos Pr√≥prios e de Terceiros (%)
                            </label>
                            <input type="number" id="ownResources" placeholder="20" min="20" max="100" value="20">
                            <div id="ownResourcesHint" style="font-size: 0.8rem; color: #7f8c8d; margin-top: 5px;">
                                üí° <strong>M√≠nimo 20%</strong> do investimento total
                            </div>
                        </div>
                    </div>

                    <div class="projeto-card">
                        <div class="section-title">
                            üìÖ Prazos
                        </div>
                        <div class="form-group required">
                            <label for="loanTerm">
                                <span class="icon-fallback">‚è∞</span> Prazo Total
                            </label>
                            <select id="loanTerm">
                                <option value="">Selecione</option>
                                <option value="5">5 anos</option>
                                <option value="8">8 anos</option>
                                <option value="10">10 anos</option>
                                <option value="12">12 anos</option>
                                <option value="15">15 anos</option>
                                <option value="20">20 anos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="gracePeriod">
                                <span class="icon-fallback">‚è∏Ô∏è</span> Car√™ncia
                            </label>
                            <select id="gracePeriod">
                                <option value="0">Sem car√™ncia</option>
                                <option value="0.5">6 meses</option>
                                <option value="1">1 ano</option>
                            </select>
                        </div>
                    </div>

                    <div class="projeto-card">
                        <div class="section-title">
                            ‚ñ∂Ô∏è A√ß√µes
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                            <button type="button" class="btn-primary" onclick="calculateResults()" style="width: 80%; max-width: 250px;">
                                üßÆ Calcular FDCO
                            </button>
                            <button type="button" class="btn-secondary" onclick="clearForm()" style="width: 80%; max-width: 250px;">
                                üóëÔ∏è Limpar
                            </button>
                            <button type="button" class="btn-secondary" onclick="showMunicipalityStats()" style="width: 80%; max-width: 250px;">
                                üìà Estat√≠sticas
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <div class="results-panel-fullwidth">
            <div id="resultsContent">
                <div class="results-placeholder" id="resultsPlaceholder">
                    <div class="placeholder-content">
                        <div class="placeholder-icon">
                            
                        </div>
                        <h2 class="results-title-full">üìä Resultados da Simula√ß√£o FDCO</h2>
                        <div class="placeholder-message">
                            <p><strong>Para calcular o financiamento FDCO:</strong></p>
                            <div class="placeholder-steps">
                                <div class="step">
                                    <span class="step-number">1</span>
                                    <span class="step-text">Preencha a <strong>Localiza√ß√£o</strong> (Estado e Munic√≠pio)</span>
                                </div>
                                <div class="step">
                                    <span class="step-number">2</span>
                                    <span class="step-text">Selecione o <strong>Setor do Projeto</strong></span>
                                </div>
                                <div class="step">
                                    <span class="step-number">3</span>
                                    <span class="step-text">Informe os <strong>Dados Financeiros</strong></span>
                                </div>
                                <div class="step">
                                    <span class="step-number">4</span>
                                    <span class="step-text">Configure os <strong>Prazos</strong></span>
                                </div>
                                <div class="step">
                                    <span class="step-number">5</span>
                                    <span class="step-text">Clique em <strong>"Calcular FDCO"</strong></span>
                                </div>
                            </div>
                            <div class="placeholder-note">
                                üí° Os resultados aparecer√£o aqui ap√≥s o c√°lculo
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="simulationResults" style="display: none;">
                    <h2 class="results-title-full">üìä Resultados da Simula√ß√£o FDCO</h2>
                    <div style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; padding: 1rem; margin: 1rem 0; text-align: center;">
                        <strong style="color: #856404; font-size: 1.1rem;">
                            ‚ö†Ô∏è SIMULADOR EDUCACIONAL - N√ÉO OFICIAL
                        </strong>
                        <div style="font-size: 0.9rem; color: #856404; margin-top: 0.5rem;">
                            Este simulador foi desenvolvido para fins educacionais e de estudo.<br>
                            Os c√°lculos s√£o baseados nas Resolu√ß√µes do CMN 4.960/2021 e CONDEL 154 e 158/2024 e par√¢metros p√∫blicos dispon√≠veis.<br>
                            <strong>Para opera√ß√µes oficiais, consulte sempre a <a href="https://www.gov.br/sudeco/pt-br" target="_blank" style="color: #856404; text-decoration: underline; font-weight: bold;">SUDECO</a>.</strong><br>
                            Para solicitar uma Consulta Pr√©via, <a href="https://www.gov.br/sudeco/pt-br/assuntos/fundo-de-desenvolvimento-do-centro-oeste/consultas-previas" target="_blank" style="color: #856404; text-decoration: underline; font-weight: bold;">fa√ßa seu cadastro aqui</a>.
                        </div>
                    </div>
                    
                    <!-- Status de Aprova√ß√£o -->
                    <div id="approvalStatus" style="display: none; margin-bottom: 20px;"></div>
                    
                    <div class="results-horizontal">
                        <div class="results-card">
                            <div class="highlight-result-large">
                                <span class="value-large" id="fdcoLoanAmount">R$ 0,00</span>
                                <span class="label-large">üí∞ Financiamento FDCO</span>
                            </div>
                        </div>
                        
                        <div class="results-card">
                            <h4 class="results-card-title">üìä M√©tricas Principais</h4>
                            <div class="result-item-large"><span class="result-label-large">Taxa TFD:</span><span class="result-value-large" id="tfdRate">0,0% a.a.</span></div>
                            <div class="result-item-large"><span class="result-label-large">Fator de Programa:</span><span class="result-value-large" id="fpValue">0,00</span></div>
                            <div class="result-item-large"><span class="result-label-large">% Participa√ß√£o FDCO:</span><span class="result-value-large" id="fdcoPercentage">0%</span></div>
                        </div>
                        
                        <div class="results-card">
                            <h4 class="results-card-title">üíº Composi√ß√£o Financeira</h4>
                            <div class="result-item-large"><span class="result-label-large">Recursos Pr√≥prios:</span><span class="result-value-large" id="ownResourcesAmount">R$ 0,00</span></div>
                            <div class="result-item-large"><span class="result-label-large">Amortiza√ß√£o SAC:</span><span class="result-value-large" id="sacAmortization">R$ 0,00</span></div>
                            <div class="result-item-large"><span class="result-label-large">1¬™ Presta√ß√£o:</span><span class="result-value-large" id="firstPayment">R$ 0,00</span></div>
                        </div>
                    </div>
                    
                    <div class="schedule-section">
                        <h3 class="schedule-title">üìÖ Cronograma de Pagamentos - Sistema SAC</h3>
                        <div id="paymentSchedule" class="payment-schedule-large"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dados dos munic√≠pios por estado
        const municipalityData = {
            'DF': [
                { name: 'BRAS√çLIA', prioridade_espacial: 'DEMAIS' }
            ],
            'GO': [
                { name: 'ABADIA DE GOI√ÅS', prioridade_espacial: 'DEMAIS' },
                { name: 'ABADI√ÇNIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ACRE√öNA', prioridade_espacial: 'DEMAIS' },
                { name: 'ADEL√ÇNDIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: '√ÅGUA FRIA DE GOI√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: '√ÅGUA LIMPA', prioridade_espacial: 'DEMAIS' },
                { name: '√ÅGUAS LINDAS DE GOI√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ALEX√ÇNIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ALO√ÇNDIA', prioridade_espacial: 'DEMAIS' },
                { name: 'ALTO HORIZONTE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ALTO PARA√çSO DE GOI√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ALVORADA DO NORTE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'AMARALINA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'AMERICANO DO BRASIL', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'AMORIN√ìPOLIS', prioridade_espacial: 'DEMAIS' },
                { name: 'AN√ÅPOLIS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ANHANGUERA', prioridade_espacial: 'DEMAIS' },
                { name: 'ANICUNS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'APARECIDA DE GOI√ÇNIA', prioridade_espacial: 'DEMAIS' },
                { name: 'APARECIDA DO RIO DOCE', prioridade_espacial: 'DEMAIS' },
                { name: 'APOR√â', prioridade_espacial: 'DEMAIS' },
                { name: 'ARA√áU', prioridade_espacial: 'DEMAIS' },
                { name: 'ARAGAR√áAS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ARAGOI√ÇNIA', prioridade_espacial: 'DEMAIS' },
                { name: 'ARAGUAPAZ', prioridade_espacial: 'DEMAIS' },
                { name: 'AREN√ìPOLIS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ARUAN√É', prioridade_espacial: 'DEMAIS' },
                { name: 'AURIL√ÇNDIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'AVELIN√ìPOLIS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'BALIZA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'BARRO ALTO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'BELA VISTA DE GOI√ÅS', prioridade_espacial: 'DEMAIS' },
                { name: 'BOM JARDIM DE GOI√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'BOM JESUS DE GOI√ÅS', prioridade_espacial: 'DEMAIS' },
                { name: 'BONFIN√ìPOLIS', prioridade_espacial: 'DEMAIS' },
                { name: 'BON√ìPOLIS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'BRAZABRANTES', prioridade_espacial: 'DEMAIS' },
                { name: 'BRIT√ÇNIA', prioridade_espacial: 'DEMAIS' },
                { name: 'BURITI ALEGRE', prioridade_espacial: 'DEMAIS' },
                { name: 'BURITI DE GOI√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'BURITIN√ìPOLIS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'CABECEIRAS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'CACHOEIRA ALTA', prioridade_espacial: 'DEMAIS' },
                { name: 'CACHOEIRA DE GOI√ÅS', prioridade_espacial: 'DEMAIS' },
                { name: 'CACHOEIRA DOURADA', prioridade_espacial: 'DEMAIS' },
                { name: 'CA√áU', prioridade_espacial: 'DEMAIS' },
                { name: 'CAIAP√îNIA', prioridade_espacial: 'DEMAIS' },
                { name: 'CALDAS NOVAS', prioridade_espacial: 'DEMAIS' },
                { name: 'CALDAZINHA', prioridade_espacial: 'DEMAIS' },
                { name: 'CAMPESTRE DE GOI√ÅS', prioridade_espacial: 'DEMAIS' },
                { name: 'CAMPINA√áU', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'CAMPINORTE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'CAMPO ALEGRE DE GOI√ÅS', prioridade_espacial: 'DEMAIS' },
                { name: 'CAMPO LIMPO DE GOI√ÅS', prioridade_espacial: 'DEMAIS' },
                { name: 'CAMPOS BELOS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'CAMPOS VERDES', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'CARMO DO RIO VERDE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'CASTEL√ÇNDIA', prioridade_espacial: 'DEMAIS' },
                { name: 'CATAL√ÉO', prioridade_espacial: 'DEMAIS' },
                { name: 'CATURA√ç', prioridade_espacial: 'DEMAIS' },
                { name: 'CAVALCANTE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'CERES', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'CEZARINA', prioridade_espacial: 'DEMAIS' },
                { name: 'CHAPAD√ÉO DO C√âU', prioridade_espacial: 'DEMAIS' },
                { name: 'CIDADE OCIDENTAL', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'COCALZINHO DE GOI√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'COLINAS DO SUL', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'C√ìRREGO DO OURO', prioridade_espacial: 'DEMAIS' },
                { name: 'CORUMB√Å DE GOI√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'CORUMBA√çBA', prioridade_espacial: 'DEMAIS' },
                { name: 'CRISTALINA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'CRISTIAN√ìPOLIS', prioridade_espacial: 'DEMAIS' },
                { name: 'CRIX√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'CROM√çNIA', prioridade_espacial: 'DEMAIS' },
                { name: 'CUMARI', prioridade_espacial: 'DEMAIS' },
                { name: 'DAMIAN√ìPOLIS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'DAMOL√ÇNDIA', prioridade_espacial: 'DEMAIS' },
                { name: 'DAVIN√ìPOLIS', prioridade_espacial: 'DEMAIS' },
                { name: 'DIORAMA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'DIVIN√ìPOLIS DE GOI√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'DOVERL√ÇNDIA', prioridade_espacial: 'DEMAIS' },
                { name: 'EDEALINA', prioridade_espacial: 'DEMAIS' },
                { name: 'ED√âIA', prioridade_espacial: 'DEMAIS' },
                { name: 'ESTRELA DO NORTE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'FAINA', prioridade_espacial: 'DEMAIS' },
                { name: 'FAZENDA NOVA', prioridade_espacial: 'DEMAIS' },
                { name: 'FIRMIN√ìPOLIS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'FLORES DE GOI√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'FORMOSA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'FORMOSO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'GAMELEIRA DE GOI√ÅS', prioridade_espacial: 'DEMAIS' },
                { name: 'GOIAN√ÅPOLIS', prioridade_espacial: 'DEMAIS' },
                { name: 'GOIANDIRA', prioridade_espacial: 'DEMAIS' },
                { name: 'GOIAN√âSIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'GOI√ÇNIA', prioridade_espacial: 'DEMAIS' },
                { name: 'GOIANIRA', prioridade_espacial: 'DEMAIS' },
                { name: 'GOI√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'GOIATUBA', prioridade_espacial: 'DEMAIS' },
                { name: 'GOUVEL√ÇNDIA', prioridade_espacial: 'DEMAIS' },
                { name: 'GUAP√ì', prioridade_espacial: 'DEMAIS' },
                { name: 'GUARA√çTA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'GUARANI DE GOI√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'GUARINOS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'HEITORA√ç', prioridade_espacial: 'DEMAIS' },
                { name: 'HIDROL√ÇNDIA', prioridade_espacial: 'DEMAIS' },
                { name: 'HIDROLINA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'IACIARA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'INACIOL√ÇNDIA', prioridade_espacial: 'DEMAIS' },
                { name: 'INDIARA', prioridade_espacial: 'DEMAIS' },
                { name: 'INHUMAS', prioridade_espacial: 'DEMAIS' },
                { name: 'IPAMERI', prioridade_espacial: 'DEMAIS' },
                { name: 'IPIRANGA DE GOI√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'IPOR√Å', prioridade_espacial: 'DEMAIS' },
                { name: 'ISRAEL√ÇNDIA', prioridade_espacial: 'DEMAIS' },
                { name: 'ITABERA√ç', prioridade_espacial: 'DEMAIS' },
                { name: 'ITAGUARI', prioridade_espacial: 'DEMAIS' },
                { name: 'ITAGUARU', prioridade_espacial: 'DEMAIS' },
                { name: 'ITAJ√Å', prioridade_espacial: 'DEMAIS' },
                { name: 'ITAPACI', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ITAPIRAPU√É', prioridade_espacial: 'DEMAIS' },
                { name: 'ITAPURANGA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ITARUM√É', prioridade_espacial: 'DEMAIS' },
                { name: 'ITAU√áU', prioridade_espacial: 'DEMAIS' },
                { name: 'ITUMBIARA', prioridade_espacial: 'DEMAIS' },
                { name: 'IVOL√ÇNDIA', prioridade_espacial: 'DEMAIS' },
                { name: 'JANDAIA', prioridade_espacial: 'DEMAIS' },
                { name: 'JARAGU√Å', prioridade_espacial: 'DEMAIS' },
                { name: 'JATA√ç', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'JAUPACI', prioridade_espacial: 'DEMAIS' },
                { name: 'JES√öPOLIS', prioridade_espacial: 'DEMAIS' },
                { name: 'JOVI√ÇNIA', prioridade_espacial: 'DEMAIS' },
                { name: 'JUSSARA', prioridade_espacial: 'DEMAIS' },
                { name: 'LAGOA SANTA', prioridade_espacial: 'DEMAIS' },
                { name: 'LEOPOLDO DE BULH√ïES', prioridade_espacial: 'DEMAIS' },
                { name: 'LUZI√ÇNIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'MAIRIPOTABA', prioridade_espacial: 'DEMAIS' },
                { name: 'MAMBA√ç', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'MARA ROSA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'MARZAG√ÉO', prioridade_espacial: 'DEMAIS' },
                { name: 'MATRINCH√É', prioridade_espacial: 'DEMAIS' },
                { name: 'MAURIL√ÇNDIA', prioridade_espacial: 'DEMAIS' },
                { name: 'MIMOSO DE GOI√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'MINA√áU', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'MINEIROS', prioridade_espacial: 'DEMAIS' },
                { name: 'MOIPOR√Å', prioridade_espacial: 'DEMAIS' },
                { name: 'MONTE ALEGRE DE GOI√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'MONTES CLAROS DE GOI√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'MONTIVIDIU', prioridade_espacial: 'DEMAIS' },
                { name: 'MONTIVIDIU DO NORTE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'MORRINHOS', prioridade_espacial: 'DEMAIS' },
                { name: 'MORRO AGUDO DE GOI√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'MOSS√ÇMEDES', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'MOZARL√ÇNDIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'MUNDO NOVO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'MUTUN√ìPOLIS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NAZ√ÅRIO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NER√ìPOLIS', prioridade_espacial: 'DEMAIS' },
                { name: 'NIQUEL√ÇNDIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVA AM√âRICA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVA AURORA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVA CRIX√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVA GL√ìRIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVA IGUA√áU DE GOI√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVA ROMA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVA VENEZA', prioridade_espacial: 'DEMAIS' },
                { name: 'NOVO BRASIL', prioridade_espacial: 'DEMAIS' },
                { name: 'NOVO GAMA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVO PLANALTO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ORIZONA', prioridade_espacial: 'DEMAIS' },
                { name: 'OURO VERDE DE GOI√ÅS', prioridade_espacial: 'DEMAIS' },
                { name: 'OUVIDOR', prioridade_espacial: 'DEMAIS' },
                { name: 'PADRE BERNARDO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'PALESTINA DE GOI√ÅS', prioridade_espacial: 'DEMAIS' },
                { name: 'PALMEIRAS DE GOI√ÅS', prioridade_espacial: 'DEMAIS' },
                { name: 'PALMELO', prioridade_espacial: 'DEMAIS' },
                { name: 'PALMIN√ìPOLIS', prioridade_espacial: 'DEMAIS' },
                { name: 'PANAM√Å', prioridade_espacial: 'DEMAIS' },
                { name: 'PARANAIGUARA', prioridade_espacial: 'DEMAIS' },
                { name: 'PARA√öNA', prioridade_espacial: 'DEMAIS' },
                { name: 'PEROL√ÇNDIA', prioridade_espacial: 'DEMAIS' },
                { name: 'PETROLINA DE GOI√ÅS', prioridade_espacial: 'DEMAIS' },
                { name: 'PILAR DE GOI√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'PIRACANJUBA', prioridade_espacial: 'DEMAIS' },
                { name: 'PIRANHAS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'PIREN√ìPOLIS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'PIRES DO RIO', prioridade_espacial: 'DEMAIS' },
                { name: 'PLANALTINA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'PONTALINA', prioridade_espacial: 'DEMAIS' },
                { name: 'PORANGATU', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'PORTEIR√ÉO', prioridade_espacial: 'DEMAIS' },
                { name: 'PORTEL√ÇNDIA', prioridade_espacial: 'DEMAIS' },
                { name: 'POSSE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'PROFESSOR JAMIL', prioridade_espacial: 'DEMAIS' },
                { name: 'QUIRIN√ìPOLIS', prioridade_espacial: 'DEMAIS' },
                { name: 'RIALMA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'RIAN√ÅPOLIS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'RIO QUENTE', prioridade_espacial: 'DEMAIS' },
                { name: 'RIO VERDE', prioridade_espacial: 'DEMAIS' },
                { name: 'RUBIATABA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'SANCLERL√ÇNDIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'SANTA B√ÅRBARA DE GOI√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'SANTA CRUZ DE GOI√ÅS', prioridade_espacial: 'DEMAIS' },
                { name: 'SANTA F√â DE GOI√ÅS', prioridade_espacial: 'DEMAIS' },
                { name: 'SANTA HELENA DE GOI√ÅS', prioridade_espacial: 'DEMAIS' },
                { name: 'SANTA ISABEL', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'SANTA RITA DO ARAGUAIA', prioridade_espacial: 'DEMAIS' },
                { name: 'SANTA RITA DO NOVO DESTINO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'SANTA ROSA DE GOI√ÅS', prioridade_espacial: 'DEMAIS' },
                { name: 'SANTA TEREZA DE GOI√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'SANTA TEREZINHA DE GOI√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'SANTO ANT√îNIO DA BARRA', prioridade_espacial: 'DEMAIS' },
                { name: 'SANTO ANT√îNIO DE GOI√ÅS', prioridade_espacial: 'DEMAIS' },
                { name: 'SANTO ANT√îNIO DO DESCOBERTO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'S√ÉO DOMINGOS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'S√ÉO FRANCISCO DE GOI√ÅS', prioridade_espacial: 'DEMAIS' },
                { name: 'S√ÉO JO√ÉO DA PARA√öNA', prioridade_espacial: 'DEMAIS' },
                { name: 'S√ÉO JO√ÉO D\'ALIAN√áA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'S√ÉO LU√çS DE MONTES BELOS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'S√ÉO LU√çZ DO NORTE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'S√ÉO MIGUEL DO ARAGUAIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'S√ÉO MIGUEL DO PASSA QUATRO', prioridade_espacial: 'DEMAIS' },
                { name: 'S√ÉO PATR√çCIO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'S√ÉO SIM√ÉO', prioridade_espacial: 'DEMAIS' },
                { name: 'SENADOR CANEDO', prioridade_espacial: 'DEMAIS' },
                { name: 'SERRAN√ìPOLIS', prioridade_espacial: 'DEMAIS' },
                { name: 'SILV√ÇNIA', prioridade_espacial: 'DEMAIS' },
                { name: 'SIMOL√ÇNDIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'S√çTIO D\'ABADIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'TAQUARAL DE GOI√ÅS', prioridade_espacial: 'DEMAIS' },
                { name: 'TERESINA DE GOI√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'TEREZ√ìPOLIS DE GOI√ÅS', prioridade_espacial: 'DEMAIS' },
                { name: 'TR√äS RANCHOS', prioridade_espacial: 'DEMAIS' },
                { name: 'TRINDADE', prioridade_espacial: 'DEMAIS' },
                { name: 'TROMBAS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'TURV√ÇNIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'TURVEL√ÇNDIA', prioridade_espacial: 'DEMAIS' },
                { name: 'UIRAPURU', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'URUA√áU', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'URUANA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'URUTA√ç', prioridade_espacial: 'DEMAIS' },
                { name: 'VALPARA√çSO DE GOI√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'VARJ√ÉO', prioridade_espacial: 'DEMAIS' },
                { name: 'VIAN√ìPOLIS', prioridade_espacial: 'DEMAIS' },
                { name: 'VICENTIN√ìPOLIS', prioridade_espacial: 'DEMAIS' },
                { name: 'VILA BOA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'VILA PROP√çCIO', prioridade_espacial: 'PRIORIT√ÅRIA' }
            ],
            'MT': [
                { name: 'ACORIZAL', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: '√ÅGUA BOA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ALTA FLORESTA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ALTO ARAGUAIA', prioridade_espacial: 'DEMAIS' },
                { name: 'ALTO BOA VISTA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ALTO PARAGUAI', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ALTO TAQUARI', prioridade_espacial: 'DEMAIS' },
                { name: 'ALTO GAR√áAS', prioridade_espacial: 'DEMAIS' },
                { name: 'APIAC√ÅS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ARAGUAIANA', prioridade_espacial: 'DEMAIS' },
                { name: 'ARAGUAINHA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ARAPUTANGA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'AREN√ÅPOLIS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ARIPUAN√É', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'BAR√ÉO DE MELGA√áO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'BARRA DO GAR√áAS', prioridade_espacial: 'DEMAIS' },
                { name: 'BARRA DO BUGRES', prioridade_espacial: 'DEMAIS' },
                { name: 'BOM JESUS DO ARAGUAIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'BRASNORTE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'C√ÅCERES', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'CAMPIN√ÅPOLIS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'CAMPO NOVO DO PARECIS', prioridade_espacial: 'DEMAIS' },
                { name: 'CAMPO VERDE', prioridade_espacial: 'DEMAIS' },
                { name: 'CAMPOS DE J√öLIO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'CANABRAVA DO NORTE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'CANARANA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'CARLINDA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'CASTANHEIRA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'CHAPADA DOS GUIMAR√ÉES', prioridade_espacial: 'DEMAIS' },
                { name: 'CL√ÅUDIA', prioridade_espacial: 'DEMAIS' },
                { name: 'COCALINHO', prioridade_espacial: 'DEMAIS' },
                { name: 'COL√çDER', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'COLNIZA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'COMODORO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'CONFRESA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'CONQUISTA D\'OESTE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'COTRIGUA√áU', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'CUIAB√Å', prioridade_espacial: 'DEMAIS' },
                { name: 'CURVEL√ÇNDIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'DENISE', prioridade_espacial: 'DEMAIS' },
                { name: 'DIAMANTINO', prioridade_espacial: 'DEMAIS' },
                { name: 'DOM AQUINO', prioridade_espacial: 'DEMAIS' },
                { name: 'FELIZ NATAL', prioridade_espacial: 'DEMAIS' },
                { name: 'FIGUEIR√ìPOLIS D\'OESTE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'GA√öCHA DO NORTE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'GENERAL CARNEIRO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'GL√ìRIA D\'OESTE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'GUARANT√É DO NORTE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'GUIRATINGA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'INDIAVA√ç', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'IPIRANGA DO NORTE', prioridade_espacial: 'DEMAIS' },
                { name: 'ITANHANG√Å', prioridade_espacial: 'DEMAIS' },
                { name: 'ITA√öBA', prioridade_espacial: 'DEMAIS' },
                { name: 'ITIQUIRA', prioridade_espacial: 'DEMAIS' },
                { name: 'JACIARA', prioridade_espacial: 'DEMAIS' },
                { name: 'JANGADA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'JAURU', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'JUARA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'JU√çNA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'JURUENA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'JUSCIMEIRA', prioridade_espacial: 'DEMAIS' },
                { name: 'LAMBARI D\'OESTE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'LUCAS DO RIO VERDE', prioridade_espacial: 'DEMAIS' },
                { name: 'LUCIARA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'MARCEL√ÇNDIA', prioridade_espacial: 'DEMAIS' },
                { name: 'MATUP√Å', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'MIRASSOL D\'OESTE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOBRES', prioridade_espacial: 'DEMAIS' },
                { name: 'NORTEL√ÇNDIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOSSA SENHORA DO LIVRAMENTO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVA BANDEIRANTES', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVA BRASIL√ÇNDIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVA CANA√É DO NORTE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVA GUARITA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVA LACERDA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVA MARIL√ÇNDIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVA MARING√Å', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVA MONTE VERDE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVA MUTUM', prioridade_espacial: 'DEMAIS' },
                { name: 'NOVA NAZAR√â', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVA OL√çMPIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVA SANTA HELENA', prioridade_espacial: 'DEMAIS' },
                { name: 'NOVA UBIRAT√É', prioridade_espacial: 'DEMAIS' },
                { name: 'NOVA XAVANTINA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVO HORIZONTE DO NORTE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVO MUNDO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVO SANTO ANT√îNIO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVO S√ÉO JOAQUIM', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'PARANA√çTA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'PARANATINGA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'PEDRA PRETA', prioridade_espacial: 'DEMAIS' },
                { name: 'PEIXOTO DE AZEVEDO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'PLANALTO DA SERRA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'POCON√â', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'PONTAL DO ARAGUAIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'PONTE BRANCA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'PONTES E LACERDA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'PORTO ALEGRE DO NORTE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'PORTO DOS GA√öCHOS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'PORTO ESPERIDI√ÉO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'PORTO ESTRELA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'POXOR√âU', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'PRIMAVERA DO LESTE', prioridade_espacial: 'DEMAIS' },
                { name: 'QUER√äNCIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'RESERVA DO CABA√áAL', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'RIBEIR√ÉO CASCALHEIRA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'RIBEIR√ÉOZINHO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'RIO BRANCO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'RONDOL√ÇNDIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'RONDON√ìPOLIS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ROS√ÅRIO OESTE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'SALTO DO C√âU', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'SANTA CARMEM', prioridade_espacial: 'DEMAIS' },
                { name: 'SANTA CRUZ DO XINGU', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'SANTA RITA DO TRIVELATO', prioridade_espacial: 'DEMAIS' },
                { name: 'SANTA TEREZINHA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'SANTO AFONSO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'SANTO ANT√îNIO DO LESTE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'SANTO ANT√îNIO DO LEVERGER', prioridade_espacial: 'DEMAIS' },
                { name: 'S√ÉO F√âLIX DO ARAGUAIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'S√ÉO JOS√â DO POVO', prioridade_espacial: 'DEMAIS' },
                { name: 'S√ÉO JOS√â DO RIO CLARO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'S√ÉO JOS√â DO XINGU', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'S√ÉO JOS√â DOS QUATRO MARCOS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'S√ÉO PEDRO DA CIPA', prioridade_espacial: 'DEMAIS' },
                { name: 'SAPEZAL', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'SERRA NOVA DOURADA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'SINOP', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'SORRISO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'TABAPOR√É', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'TANGAR√Å DA SERRA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'TAPURAH', prioridade_espacial: 'DEMAIS' },
                { name: 'TERRA NOVA DO NORTE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'TESOURO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'TORIXOR√âU', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'UNI√ÉO DO SUL', prioridade_espacial: 'DEMAIS' },
                { name: 'VALE DE S√ÉO DOMINGOS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'V√ÅRZEA GRANDE', prioridade_espacial: 'DEMAIS' },
                { name: 'VERA', prioridade_espacial: 'DEMAIS' },
                { name: 'VILA BELA DA SANT√çSSIMA TRINDADE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'VILA RICA', prioridade_espacial: 'PRIORIT√ÅRIA' }
            ],
            'MS': [
                { name: '√ÅGUA CLARA', prioridade_espacial: 'DEMAIS' },
                { name: 'ALCIN√ìPOLIS', prioridade_espacial: 'DEMAIS' },
                { name: 'AMAMBAI', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ANAST√ÅCIO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ANAURIL√ÇNDIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ANG√âLICA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ANT√îNIO JO√ÉO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'APARECIDA DO TABOADO', prioridade_espacial: 'DEMAIS' },
                { name: 'AQUIDAUANA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ARAL MOREIRA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'BANDEIRANTES', prioridade_espacial: 'DEMAIS' },
                { name: 'BATAGUASSU', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'BATAYPOR√É', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'BELA VISTA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'BODOQUENA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'BONITO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'BRASIL√ÇNDIA', prioridade_espacial: 'DEMAIS' },
                { name: 'CAARAP√ì', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'CAMAPU√É', prioridade_espacial: 'DEMAIS' },
                { name: 'CAMPO GRANDE', prioridade_espacial: 'DEMAIS' },
                { name: 'CARACOL', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'CASSIL√ÇNDIA', prioridade_espacial: 'DEMAIS' },
                { name: 'CHAPAD√ÉO DO SUL', prioridade_espacial: 'DEMAIS' },
                { name: 'CORGUINHO', prioridade_espacial: 'DEMAIS' },
                { name: 'CORONEL SAPUCAIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'CORUMB√Å', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'COSTA RICA', prioridade_espacial: 'DEMAIS' },
                { name: 'COXIM', prioridade_espacial: 'DEMAIS' },
                { name: 'DEOD√ÅPOLIS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'DOIS IRM√ÉOS DO BURITI', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'DOURADINA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'DOURADOS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ELDORADO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'F√ÅTIMA DO SUL', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'FIGUEIR√ÉO', prioridade_espacial: 'DEMAIS' },
                { name: 'GL√ìRIA DE DOURADOS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'GUIA LOPES DA LAGUNA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'IGUATEMI', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'INOC√äNCIA', prioridade_espacial: 'DEMAIS' },
                { name: 'ITAPOR√É', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'ITAQUIRA√ç', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'IVINHEMA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'JAPOR√É', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'JARAGUARI', prioridade_espacial: 'DEMAIS' },
                { name: 'JARDIM', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'JATE√ç', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'JUTI', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'LAD√ÅRIO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'LAGUNA CARAP√É', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'MARACAJU', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'MIRANDA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'MUNDO NOVO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NAVIRA√ç', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NIOAQUE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVA ALVORADA DO SUL', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVA ANDRADINA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'NOVO HORIZONTE DO SUL', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'PARA√çSO DAS √ÅGUAS', prioridade_espacial: 'DEMAIS' },
                { name: 'PARANA√çBA', prioridade_espacial: 'DEMAIS' },
                { name: 'PARANHOS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'PEDRO GOMES', prioridade_espacial: 'DEMAIS' },
                { name: 'PONTA POR√É', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'PORTO MURTINHO', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'RIBAS DO RIO PARDO', prioridade_espacial: 'DEMAIS' },
                { name: 'RIO BRILHANTE', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'RIO NEGRO', prioridade_espacial: 'DEMAIS' },
                { name: 'RIO VERDE DE MATO GROSSO', prioridade_espacial: 'DEMAIS' },
                { name: 'ROCHEDO', prioridade_espacial: 'DEMAIS' },
                { name: 'SANTA RITA DO PARDO', prioridade_espacial: 'DEMAIS' },
                { name: 'S√ÉO GABRIEL DO OESTE', prioridade_espacial: 'DEMAIS' },
                { name: 'SELV√çRIA', prioridade_espacial: 'DEMAIS' },
                { name: 'SETE QUEDAS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'SIDROL√ÇNDIA', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'SONORA', prioridade_espacial: 'DEMAIS' },
                { name: 'TACURU', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'TAQUARUSSU', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'TERENOS', prioridade_espacial: 'DEMAIS' },
                { name: 'TR√äS LAGOAS', prioridade_espacial: 'PRIORIT√ÅRIA' },
                { name: 'VICENTINA', prioridade_espacial: 'PRIORIT√ÅRIA' }
            ]
        };

        // Par√¢metros TFD - AGOSTO 2025 (IPCAs reais)
        let tfdParameters = {
            jm: 7.51, // TLP - 7,51% atual
            alpha: 1.00,
            cdr: 1.00,
            du: 21, // DU = 21 dias √∫teis em agosto
            ipca_m1: 0.0024, // IPCA M-1 = 0,24% (real)
            ipca_m2: 0.0026, // IPCA M-2 = 0,26% (real)
            ndup: 10,
            ndus: 11, 
            ndmp: 21,
            ndms: 21,
            lastUpdate: null
        };

        // Fun√ß√£o para buscar TLP do BACEN - SIMPLIFICADA sem CORS
        async function fetchTLP() {
            try {
                console.log('üîÑ Tentando buscar TLP do BACEN (m√©todo direto)...');
                
                // M√©todo direto sem proxy (pode falhar por CSP)
                const response = await fetch('https://api.bcb.gov.br/dados/serie/bcdata.sgs.27572/dados?formato=json', {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('üìä Dados TLP recebidos:', data);
                
                if (data && data.length > 0) {
                    const ultimoRegistro = data[data.length - 1];
                    const tlpValue = parseFloat(ultimoRegistro.valor);
                    
                    tfdParameters.jm = tlpValue;
                    
                    console.log(`‚úÖ TLP atualizada: ${tlpValue}% a.a. (${ultimoRegistro.data})`);
                    
                    const paramTlpElement = document.getElementById('param-tlp');
                    if (paramTlpElement) {
                        paramTlpElement.textContent = `${tlpValue.toFixed(2)}% a.a.`;
                    }
                    
                    return tlpValue;
                }
            } catch (error) {
                console.error('‚ùå Erro ao buscar TLP:', error.message);
                console.log(`üìã Mantendo TLP padr√£o: ${tfdParameters.jm}% a.a.`);
                console.log('');
                console.log('üí° DICA: Para atualizar a TLP manualmente:');
                console.log('   1. Abra o Console (F12)');
                console.log('   2. Digite: updateTLPManually(7.XX)');
                console.log('   3. Substitua 7.XX pela taxa atual do BACEN');
                console.log('   4. Pressione Enter');
                
                return tfdParameters.jm;
            }
        }

        // Fun√ß√£o para atualiza√ß√£o manual via console
        window.updateTLPManually = function(novoValor) {
            if (isNaN(parseFloat(novoValor))) {
                console.error('‚ùå Valor inv√°lido! Use: updateTLPManually(7.51)');
                return;
            }
            
            const valor = parseFloat(novoValor);
            tfdParameters.jm = valor;
            
            const paramTlpElement = document.getElementById('param-tlp');
            if (paramTlpElement) {
                paramTlpElement.textContent = `${valor.toFixed(2)}% a.a.`;
            }
            
            console.log(`‚úÖ TLP atualizada manualmente para: ${valor}% a.a.`);
            
            // Atualizar indicador
            const indicator = document.getElementById('last-update-indicator');
            if (indicator) {
                indicator.innerHTML = `
                    <div style="background: #d4edda; border: 1px solid #c3e6cb; border-radius: 6px; padding: 8px; font-size: 0.8rem; color: #155724;">
                        ‚úÖ <strong>TLP atualizada manualmente:</strong> ${new Date().toLocaleString('pt-BR')}
                    </div>
                `;
            }
        };

        // Fun√ß√£o para buscar IPCA do IBGE - SIMPLIFICADA
        async function fetchIPCA() {
            try {
                console.log('üîÑ Tentando buscar IPCA do IBGE...');
                
                const response = await fetch('https://servicodados.ibge.gov.br/api/v3/agregados/1737/periodos/-2/variaveis/63?localidades=N1[all]', {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data && data[0] && data[0].resultados && data[0].resultados[0] && data[0].resultados[0].series) {
                    const series = data[0].resultados[0].series[0].serie;
                    const periods = Object.keys(series).slice(-2);
                    
                    if (periods.length >= 2) {
                        const ipcaM1 = parseFloat(series[periods[1]]) / 100;
                        const ipcaM2 = parseFloat(series[periods[0]]) / 100;
                        
                        tfdParameters.ipca_m1 = ipcaM1;
                        tfdParameters.ipca_m2 = ipcaM2;
                        
                        console.log(`‚úÖ IPCA atualizado: M-1: ${(ipcaM1*100).toFixed(2)}%, M-2: ${(ipcaM2*100).toFixed(2)}%`);
                        
                        const ipcaM1Display = document.getElementById('ipca-m1-display');
                        const ipcaM2Display = document.getElementById('ipca-m2-display');
                        
                        if (ipcaM1Display) ipcaM1Display.textContent = `${(ipcaM1*100).toFixed(2)}%`;
                        if (ipcaM2Display) ipcaM2Display.textContent = `${(ipcaM2*100).toFixed(2)}%`;
                        
                        return { ipcaM1, ipcaM2, periods };
                    }
                }
                throw new Error('Dados IPCA n√£o encontrados');
            } catch (error) {
                console.error('‚ùå Erro ao buscar IPCA:', error.message);
                console.log('üìã Mantendo IPCA padr√£o: M-1: 0,24%, M-2: 0,26%');
                console.log('');
                console.log('üí° DICA: Para atualizar o IPCA manualmente:');
                console.log('   1. Abra o Console (F12)');
                console.log('   2. Digite: updateIPCAManually(0.XX, 0.YY)');
                console.log('   3. Substitua pelos valores do IBGE (M-1, M-2)');
                console.log('   4. Pressione Enter');
                return { 
                    ipcaM1: tfdParameters.ipca_m1, 
                    ipcaM2: tfdParameters.ipca_m2,
                    periods: ['padr√£o', 'padr√£o']
                };
            }
        }

        // Fun√ß√£o para atualiza√ß√£o manual do IPCA via console
        window.updateIPCAManually = function(m1Percent, m2Percent) {
            if (isNaN(parseFloat(m1Percent)) || isNaN(parseFloat(m2Percent))) {
                console.error('‚ùå Valores inv√°lidos! Use: updateIPCAManually(0.24, 0.26)');
                return;
            }
            
            const ipcaM1 = parseFloat(m1Percent) / 100;
            const ipcaM2 = parseFloat(m2Percent) / 100;
            
            tfdParameters.ipca_m1 = ipcaM1;
            tfdParameters.ipca_m2 = ipcaM2;
            
            const ipcaM1Display = document.getElementById('ipca-m1-display');
            const ipcaM2Display = document.getElementById('ipca-m2-display');
            
            if (ipcaM1Display) ipcaM1Display.textContent = `${(ipcaM1*100).toFixed(2)}%`;
            if (ipcaM2Display) ipcaM2Display.textContent = `${(ipcaM2*100).toFixed(2)}%`;
            
            console.log(`‚úÖ IPCA atualizado manualmente: M-1: ${(ipcaM1*100).toFixed(2)}%, M-2: ${(ipcaM2*100).toFixed(2)}%`);
        };

        // Lista dos feriados nacionais brasileiros
        function getFeriadosNacionais(ano) {
            const feriados = [];
            
            // Feriados fixos
            feriados.push(new Date(ano, 0, 1));   // Confraterniza√ß√£o Universal
            feriados.push(new Date(ano, 3, 21));  // Tiradentes
            feriados.push(new Date(ano, 4, 1));   // Dia do Trabalhador
            feriados.push(new Date(ano, 8, 7));   // Independ√™ncia do Brasil
            feriados.push(new Date(ano, 9, 12));  // Nossa Senhora Aparecida
            feriados.push(new Date(ano, 10, 2));  // Finados
            feriados.push(new Date(ano, 10, 15)); // Proclama√ß√£o da Rep√∫blica
            feriados.push(new Date(ano, 11, 25)); // Natal
            
            // Calcular P√°scoa e feriados m√≥veis
            const pascoa = calcularPascoa(ano);
            feriados.push(new Date(pascoa.getTime() - 47 * 24 * 60 * 60 * 1000)); // Carnaval (47 dias antes)
            feriados.push(new Date(pascoa.getTime() - 46 * 24 * 60 * 60 * 1000)); // Carnaval (46 dias antes)
            feriados.push(new Date(pascoa.getTime() - 2 * 24 * 60 * 60 * 1000));  // Sexta-feira Santa
            feriados.push(pascoa); // P√°scoa
            feriados.push(new Date(pascoa.getTime() + 60 * 24 * 60 * 60 * 1000)); // Corpus Christi
            
            return feriados;
        }
        
        // Calcular data da P√°scoa usando algoritmo de Oudin
        function calcularPascoa(ano) {
            const a = ano % 19;
            const b = Math.floor(ano / 100);
            const c = ano % 100;
            const d = Math.floor(b / 4);
            const e = b % 4;
            const f = Math.floor((b + 8) / 25);
            const g = Math.floor((b - f + 1) / 3);
            const h = (19 * a + b - d - g + 15) % 30;
            const i = Math.floor(c / 4);
            const k = c % 4;
            const l = (32 + 2 * e + 2 * i - h - k) % 7;
            const m = Math.floor((a + 11 * h + 22 * l) / 451);
            const n = Math.floor((h + l - 7 * m + 114) / 31);
            const p = (h + l - 7 * m + 114) % 31;
            
            return new Date(ano, n - 1, p + 1);
        }
        
        // Verificar se uma data √© feriado nacional
        function ehFeriado(data) {
            const ano = data.getFullYear();
            const feriados = getFeriadosNacionais(ano);
            
            return feriados.some(feriado => 
                feriado.getDate() === data.getDate() &&
                feriado.getMonth() === data.getMonth() &&
                feriado.getFullYear() === data.getFullYear()
            );
        }

        // Fun√ß√£o para calcular dias √∫teis e totais baseado na data atual - CORRIGIDA COM FERIADOS
        function calculateDateParameters() {
            const hoje = new Date();
            const mesReferencia = hoje.getMonth(); // M√™s atual como refer√™ncia "m"
            const anoReferencia = hoje.getFullYear();
            
            console.log(`üìÖ M√™s de refer√™ncia "m": ${mesReferencia + 1}/${anoReferencia} (${hoje.toLocaleDateString('pt-BR', {month: 'long'})})`);
            
            // Fun√ß√£o para contar dias √∫teis entre duas datas (excluindo s√°bados, domingos E feriados)
            function contarDiasUteisEntre(dataInicio, dataFim, fimInclusive = false) {
                let diasUteis = 0;
                let dataAtual = new Date(dataInicio);
                
                while (dataAtual < dataFim || (fimInclusive && dataAtual.getTime() === dataFim.getTime())) {
                    let diaSemana = dataAtual.getDay();
                    
                    // Verificar se √© dia √∫til: n√£o √© s√°bado (6), domingo (0) nem feriado
                    if (diaSemana !== 0 && diaSemana !== 6 && !ehFeriado(dataAtual)) {
                        diasUteis++;
                    }
                    
                    dataAtual.setDate(dataAtual.getDate() + 1);
                }
                return diasUteis;
            }
            
            // **NDUP**: Dias √∫teis de 1¬∫ a 14 do m√™s de refer√™ncia "m" (1¬∫ inclusive, 15 exclusive)
            const inicio_ndup = new Date(anoReferencia, mesReferencia, 1);
            const fim_ndup = new Date(anoReferencia, mesReferencia, 15);
            const ndup = contarDiasUteisEntre(inicio_ndup, fim_ndup, false);
            
            // **NDUS**: Dias √∫teis de 15 ao √∫ltimo dia do m√™s de refer√™ncia "m" (15 inclusive, √∫ltimo inclusive)
            const inicio_ndus = new Date(anoReferencia, mesReferencia, 15);
            const ultimoDiaMes = new Date(anoReferencia, mesReferencia + 1, 0).getDate();
            const fim_ndus = new Date(anoReferencia, mesReferencia, ultimoDiaMes);
            const ndus = contarDiasUteisEntre(inicio_ndus, fim_ndus, true);
            
            // **NDMP**: Dias √∫teis de 15 do m√™s anterior + dias √∫teis de 1¬∫ a 14 do m√™s de refer√™ncia
            // M√™s anterior
            let mesAnterior = mesReferencia - 1;
            let anoMesAnterior = anoReferencia;
            if (mesAnterior < 0) {
                mesAnterior = 11;
                anoMesAnterior = anoReferencia - 1;
            }
            
            // Parte 1: 15 ao √∫ltimo dia do m√™s anterior (15 inclusive, √∫ltimo inclusive)
            const inicio_ndmp_p1 = new Date(anoMesAnterior, mesAnterior, 15);
            const ultimoDiaMesAnterior = new Date(anoMesAnterior, mesAnterior + 1, 0).getDate();
            const fim_ndmp_p1 = new Date(anoMesAnterior, mesAnterior, ultimoDiaMesAnterior);
            const ndmp_parte1 = contarDiasUteisEntre(inicio_ndmp_p1, fim_ndmp_p1, true);
            
            // Parte 2: 1¬∫ a 14 do m√™s de refer√™ncia (1¬∫ inclusive, 15 exclusive) = NDUP
            const ndmp_parte2 = ndup;
            const ndmp = ndmp_parte1 + ndmp_parte2;
            
            // **NDMS**: Dias √∫teis de 15 do m√™s de refer√™ncia a 14 do pr√≥ximo m√™s (15 inclusive, 15 exclusive)
            // Pr√≥ximo m√™s
            let proximoMes = mesReferencia + 1;
            let anoProximoMes = anoReferencia;
            if (proximoMes > 11) {
                proximoMes = 0;
                anoProximoMes = anoReferencia + 1;
            }
            
            const inicio_ndms = new Date(anoReferencia, mesReferencia, 15);
            const fim_ndms = new Date(anoProximoMes, proximoMes, 15);
            const ndms = contarDiasUteisEntre(inicio_ndms, fim_ndms, false);
            
            // Atualizar par√¢metros
            tfdParameters.ndup = ndup;
            tfdParameters.ndus = ndus;
            tfdParameters.ndmp = ndmp;
            tfdParameters.ndms = ndms;
            
            console.log(`üìä Par√¢metros de dias √∫teis calculados (excluindo feriados nacionais):`);
            console.log(`   NDUP (1¬∫ a 14 do m√™s ${mesReferencia + 1}): ${ndup} dias √∫teis`);
            console.log(`   NDUS (15 a ${ultimoDiaMes} do m√™s ${mesReferencia + 1}): ${ndus} dias √∫teis`);
            console.log(`   NDMP (15 a ${ultimoDiaMesAnterior} do m√™s ${mesAnterior + 1} + 1¬∫ a 14 do m√™s ${mesReferencia + 1}): ${ndmp_parte1} + ${ndmp_parte2} = ${ndmp} dias √∫teis`);
            console.log(`   NDMS (15 do m√™s ${mesReferencia + 1} a 14 do m√™s ${proximoMes + 1}): ${ndms} dias √∫teis`);
            
            // Verificar se h√° feriados nos per√≠odos calculados
            const feriadosAfetados = [];
            const anosEnvolvidos = [anoMesAnterior, anoReferencia, anoProximoMes];
            anosEnvolvidos.forEach(ano => {
                const feriadosAno = getFeriadosNacionais(ano);
                feriadosAno.forEach(feriado => {
                    if (feriado >= inicio_ndmp_p1 && feriado <= fim_ndms) {
                        feriadosAfetados.push(feriado.toLocaleDateString('pt-BR'));
                    }
                });
            });
            
            if (feriadosAfetados.length > 0) {
                console.log(`üéÑ Feriados nacionais considerados: ${feriadosAfetados.join(', ')}`);
            }
            
            // Atualizar displays
            const ndupDisplay = document.getElementById('ndup-display');
            const ndusDisplay = document.getElementById('ndus-display');
            const ndmpDisplay = document.getElementById('ndmp-display');
            const ndmsDisplay = document.getElementById('ndms-display');
            
            if (ndupDisplay) ndupDisplay.textContent = ndup;
            if (ndusDisplay) ndusDisplay.textContent = ndus;
            if (ndmpDisplay) ndmpDisplay.textContent = ndmp;
            if (ndmsDisplay) ndmsDisplay.textContent = ndms;
            
            return { ndup, ndus, ndmp, ndms };
        }
        // Fun√ß√£o para buscar IPCA do IBGE
        async function fetchIPCA() {
            try {
                console.log('üîÑ Buscando IPCA do IBGE...');
                
                // API do IBGE para IPCA mensal (s√©rie 433) - mantida conforme orienta√ß√£o
                const response = await fetch('https://servicodados.ibge.gov.br/api/v3/agregados/1737/periodos/-2/variaveis/63?localidades=N1[all]');
                
                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data && data[0] && data[0].resultados && data[0].resultados[0] && data[0].resultados[0].series) {
                    const series = data[0].resultados[0].series[0].serie;
                    const periods = Object.keys(series).slice(-2); // √öltimos 2 meses
                    
                    if (periods.length >= 2) {
                        // M√™s anterior (m-1) - mais recente
                        const ipcaM1 = parseFloat(series[periods[1]]) / 100; // Converter % para decimal
                        // M√™s retrasado (m-2) - anterior ao m-1
                        const ipcaM2 = parseFloat(series[periods[0]]) / 100; // Converter % para decimal
                        
                        tfdParameters.ipca_m1 = ipcaM1;
                        tfdParameters.ipca_m2 = ipcaM2;
                        
                        console.log(`‚úÖ IPCA atualizado:`);
                        console.log(`   M-1 (${periods[1]}): ${(ipcaM1*100).toFixed(2)}%`);
                        console.log(`   M-2 (${periods[0]}): ${(ipcaM2*100).toFixed(2)}%`);
                        
                        // Atualizar displays nos par√¢metros
                        const ipcaM1Display = document.getElementById('ipca-m1-display');
                        const ipcaM2Display = document.getElementById('ipca-m2-display');
                        
                        if (ipcaM1Display) ipcaM1Display.textContent = `${(ipcaM1*100).toFixed(2)}%`;
                        if (ipcaM2Display) ipcaM2Display.textContent = `${(ipcaM2*100).toFixed(2)}%`;
                        
                        return { ipcaM1, ipcaM2, periods };
                    } else {
                        throw new Error('Dados IPCA insuficientes');
                    }
                } else {
                    throw new Error('Estrutura de dados IPCA inv√°lida');
                }
            } catch (error) {
                console.error('‚ùå Erro ao buscar IPCA:', error);
                console.log('üìã Mantendo IPCA padr√£o: M-1: 0,24%, M-2: 0,26%');
                return { 
                    ipcaM1: tfdParameters.ipca_m1, 
                    ipcaM2: tfdParameters.ipca_m2,
                    periods: ['padr√£o', 'padr√£o']
                };
            }
        }

        // Fun√ß√£o para atualizar todas as taxas
        async function updateAllRates() {
            try {
                console.log('üöÄ Iniciando atualiza√ß√£o completa...');
                console.log(`üìÖ Data atual: ${new Date().toLocaleDateString('pt-BR')}`);
                
                // Mostrar indicador de carregamento
                showLoadingIndicator(true);
                
                // 1. Calcular par√¢metros de data primeiro
                const dateParams = calculateDateParameters();
                
                // 2. Buscar TLP e IPCA em paralelo
                const [tlp, ipca] = await Promise.all([
                    fetchTLP(),
                    fetchIPCA()
                ]);
                
                // 3. Atualizar timestamp
                tfdParameters.lastUpdate = new Date().toLocaleString('pt-BR');
                
                console.log('‚úÖ Atualiza√ß√£o completa realizada com sucesso!');
                console.log(`üìä Resumo dos par√¢metros atualizados:`);
                console.log(`   TLP (JM): ${tfdParameters.jm}% a.a.`);
                console.log(`   IPCA M-1: ${(tfdParameters.ipca_m1*100).toFixed(4)}%`);
                console.log(`   IPCA M-2: ${(tfdParameters.ipca_m2*100).toFixed(4)}%`);
                console.log(`   NDUP: ${tfdParameters.ndup} dias √∫teis`);
                console.log(`   NDUS: ${tfdParameters.ndus} dias √∫teis`);
                console.log(`   NDMP: ${tfdParameters.ndmp} dias √∫teis`);
                console.log(`   NDMS: ${tfdParameters.ndms} dias √∫teis`);
                
                // 4. Atualizar indicador de √∫ltima atualiza√ß√£o
                updateLastUpdateIndicator();
                
                // 5. Mostrar notifica√ß√£o de sucesso
                showSuccessNotification();
                
                return true;
            } catch (error) {
                console.error('‚ùå Erro geral na atualiza√ß√£o:', error);
                showErrorNotification(error.message);
                return false;
            } finally {
                // Esconder indicador de carregamento
                showLoadingIndicator(false);
            }
        }

        // Fun√ß√£o para mostrar/esconder indicador de carregamento
        function showLoadingIndicator(show) {
            let indicator = document.getElementById('loading-indicator');
            
            if (show && !indicator) {
                // Criar indicador se n√£o existir
                indicator = document.createElement('div');
                indicator.id = 'loading-indicator';
                indicator.innerHTML = `
                    <div style="position: fixed; top: 20px; right: 20px; background: #3498db; color: white; padding: 10px 15px; border-radius: 8px; z-index: 9999; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 16px; height: 16px; border: 2px solid #fff; border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                            <span>Atualizando taxas...</span>
                        </div>
                    </div>
                    <style>
                        @keyframes spin {
                            0% { transform: rotate(0deg); }
                            100% { transform: rotate(360deg); }
                        }
                    </style>
                `;
                document.body.appendChild(indicator);
            } else if (!show && indicator) {
                indicator.remove();
            }
        }

        // Fun√ß√£o para mostrar notifica√ß√£o de sucesso
        function showSuccessNotification() {
            const notification = document.createElement('div');
            notification.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; background: #d4edda; border: 1px solid #c3e6cb; color: #155724; padding: 15px 20px; border-radius: 8px; z-index: 9999; box-shadow: 0 4px 12px rgba(0,0,0,0.2); max-width: 350px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                        <span style="font-size: 1.2em;">‚úÖ</span>
                        <strong>Taxas Atualizadas!</strong>
                    </div>
                    <div style="font-size: 0.9rem; line-height: 1.3;">
                        TLP: ${tfdParameters.jm}% ‚Ä¢ IPCA: ${(tfdParameters.ipca_m1*100).toFixed(2)}%/${(tfdParameters.ipca_m2*100).toFixed(2)}%<br>
                        Dias: ${tfdParameters.ndup}/${tfdParameters.ndus}/${tfdParameters.ndmp}/${tfdParameters.ndms}
                    </div>
                </div>
            `;
            document.body.appendChild(notification);
            
            // Remover ap√≥s 5 segundos
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }

        // Fun√ß√£o para mostrar notifica√ß√£o de erro
        function showErrorNotification(message) {
            const notification = document.createElement('div');
            notification.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 15px 20px; border-radius: 8px; z-index: 9999; box-shadow: 0 4px 12px rgba(0,0,0,0.2); max-width: 350px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                        <span style="font-size: 1.2em;">‚ùå</span>
                        <strong>Erro na Atualiza√ß√£o</strong>
                    </div>
                    <div style="font-size: 0.9rem;">
                        ${message}<br>
                        <small>Usando valores padr√£o.</small>
                    </div>
                </div>
            `;
            document.body.appendChild(notification);
            
            // Remover ap√≥s 7 segundos
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 7000);
        }
        function updateLastUpdateIndicator() {
            const indicator = document.getElementById('last-update-indicator');
            if (indicator && tfdParameters.lastUpdate) {
                indicator.innerHTML = `
                    <div style="background: #d4edda; border: 1px solid #c3e6cb; border-radius: 6px; padding: 8px 12px; font-size: 0.8rem; color: #155724;">
                        ‚úÖ <strong>Taxas atualizadas:</strong> ${tfdParameters.lastUpdate}
                    </div>
                `;
            }
        }

        // Definir fatores de programa (priorityFactors) - CORRIGIDO BUG
        const priorityFactors = {
            'A': 0.85, // Saneamento - PRIORIT√ÅRIA
            'B': 1.05, // Demais setores - PRIORIT√ÅRIA  
            'C': 1.25, // Saneamento - DEMAIS
            'D': 1.45  // Demais setores - DEMAIS
        };

        const sectorLimits = {
            // INFRAESTRUTURA - SANEAMENTO (Art. 3¬∫ - FP: A/C ‚Äì at√© 20 Anos)
            'infraestrutura_saneamento_III': { prioritaria: 80, demais: 70 },
            
            // INFRAESTRUTURA (Art. 3¬∫ - FP: B/D ‚Äì at√© 20 Anos)
            'infraestrutura_transportes_I': { prioritaria: 60, demais: 50 },
            'infraestrutura_armazenagem_II': { prioritaria: 60, demais: 50 },
            'infraestrutura_residuos_IV': { prioritaria: 60, demais: 50 },
            'infraestrutura_gas_V': { prioritaria: 60, demais: 50 },
            'infraestrutura_petroleo_VI': { prioritaria: 60, demais: 50 },
            'infraestrutura_logistica_VII': { prioritaria: 60, demais: 50 },
            'infraestrutura_telecomunicacoes_VIII': { prioritaria: 60, demais: 50 },
            'infraestrutura_energia_X': { prioritaria: 60, demais: 50 },
            'infraestrutura_urbana_XI': { prioritaria: 60, demais: 50 },
            'infraestrutura_portuaria_IX': { prioritaria: 60, demais: 50 },
            
            // INFRAESTRUTURA ESTRUTURANTE (FP: B/D ‚Äì at√© 20 Anos)
            'infraestrutura_estruturador': { prioritaria: 55, demais: 45 },
            
            // SERVI√áOS P√öBLICOS (FP: B/D - at√© 12 anos)
            'servicos_publicos': { prioritaria: 60, demais: 50 },
            
            // SERVI√áOS (Art. 4¬∫ - FP: B/D ‚Äì at√© 12 anos)
            'servicos_turismo_I': { prioritaria: 50, demais: 40 },
            'servicos_hospitalares_II': { prioritaria: 50, demais: 40 },
            'servicos_transporte_passageiros_III': { prioritaria: 50, demais: 40 },
            'servicos_educacionais_IV': { prioritaria: 50, demais: 40 },
            
            // TRADICIONAIS (Art. 4¬∫ - FP: B/D ‚Äì at√© 12 anos)
            'tradicionais_agricultura_I': { prioritaria: 50, demais: 40 },
            'tradicionais_veiculos_II': { prioritaria: 50, demais: 40 },
            'tradicionais_couros_III_a': { prioritaria: 50, demais: 40 },
            'tradicionais_plasticos_III_b': { prioritaria: 50, demais: 40 },
            'tradicionais_latex_III_c': { prioritaria: 50, demais: 40 },
            'tradicionais_textil_III_d': { prioritaria: 50, demais: 40 },
            'tradicionais_maquinas_III_e': { prioritaria: 50, demais: 40 },
            'tradicionais_minerais_III_f': { prioritaria: 50, demais: 40 },
            'tradicionais_quimicos_III_g': { prioritaria: 50, demais: 40 },
            'tradicionais_moveis_madeira_III_h': { prioritaria: 50, demais: 40 },
            'tradicionais_alimentos_III_i': { prioritaria: 50, demais: 40 },
            'tradicionais_embalagens_III_j': { prioritaria: 50, demais: 40 },
            'tradicionais_cimento_III_k': { prioritaria: 50, demais: 40 },
            'tradicionais_reciclagem_III_l': { prioritaria: 50, demais: 40 },
            'tradicionais_papel_III_m': { prioritaria: 50, demais: 40 },
            'tradicionais_mineracao_IV': { prioritaria: 50, demais: 40 },
            'tradicionais_agroindustria_V': { prioritaria: 50, demais: 40 },
            'tradicionais_apicultura_VI': { prioritaria: 50, demais: 40 },
            'tradicionais_laticinios_VII': { prioritaria: 50, demais: 40 },
            'tradicionais_agropecuaria_VIII': { prioritaria: 50, demais: 40 },
            'tradicionais_aquicultura_IX': { prioritaria: 50, demais: 40 },
            'tradicionais_suinocultura_X': { prioritaria: 50, demais: 40 },
            'tradicionais_lavoura_pecuaria_XI': { prioritaria: 50, demais: 40 },
            
            // CTI - CI√äNCIA, TECNOLOGIA E INOVA√á√ÉO (Art. 5¬∫ - FP: B/D ‚Äì at√© 12 Anos)
            'cti_biotecnologia_I': { prioritaria: 50, demais: 40 },
            'cti_telecomunicacoes_II': { prioritaria: 50, demais: 40 },
            'cti_nanotecnologia_III': { prioritaria: 50, demais: 40 },
            'cti_geotecnologia_IV': { prioritaria: 50, demais: 40 },
            'cti_mecatronica_V': { prioritaria: 50, demais: 40 },
            'cti_tic_VI': { prioritaria: 50, demais: 40 },
            'cti_equipamentos_medicos_VII': { prioritaria: 50, demais: 40 },
            'cti_industria_4_VIII': { prioritaria: 50, demais: 40 },
            'cti_farmaco_IX': { prioritaria: 50, demais: 40 },
            'cti_biocombustiveis_X': { prioritaria: 50, demais: 40 },
            'cti_energia_renovavel_XI': { prioritaria: 50, demais: 40 },
            'cti_petroleo_gas_XII': { prioritaria: 50, demais: 40 },
            'cti_bioeconomia_XIII': { prioritaria: 50, demais: 40 },
            'cti_meteorologia_XIV': { prioritaria: 50, demais: 40 },
            'cti_aeronautico_XV': { prioritaria: 50, demais: 40 },
            'cti_nuclear_XVI': { prioritaria: 50, demais: 40 },
            'cti_defesa_XVII': { prioritaria: 50, demais: 40 },
            'cti_industria_defesa_XVIII': { prioritaria: 50, demais: 40 },
            'cti_agro_digital_XIX': { prioritaria: 50, demais: 40 }
        };

        const standardLimit = 50000000; // R$ 50 milh√µes - limite padr√£o para aviso

        // Fun√ß√£o para atualiza√ß√£o manual via interface amig√°vel
        function updateRatesManually() {
            const currentTLP = tfdParameters.jm;
            const currentIPCA_M1 = (tfdParameters.ipca_m1 * 100).toFixed(2);
            const currentIPCA_M2 = (tfdParameters.ipca_m2 * 100).toFixed(2);
            
            // Modal para atualiza√ß√£o manual
            const modalHTML = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 15px; padding: 30px; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                        <div style="text-align: center; margin-bottom: 25px;">
                            <h2 style="color: #2c3e50; margin-bottom: 10px;">üîÑ Atualizar Taxas Manualmente</h2>
                            <p style="color: #7f8c8d; font-size: 0.95rem;">APIs bloqueadas pelo ambiente. Digite os valores atuais:</p>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50;">
                                üìà TLP - Taxa de Longo Prazo (% a.a.):
                            </label>
                            <input type="number" id="manual-tlp" value="${currentTLP}" step="0.01" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;">
                            <small style="color: #7f8c8d;">Fonte: S√©rie 27572 do BACEN</small>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50;">
                                üìä IPCA M√™s Anterior - M-1 (%):
                            </label>
                            <input type="number" id="manual-ipca-m1" value="${currentIPCA_M1}" step="0.01" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;">
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50;">
                                üìä IPCA M√™s Retrasado - M-2 (%):
                            </label>
                            <input type="number" id="manual-ipca-m2" value="${currentIPCA_M2}" step="0.01" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;">
                            <small style="color: #7f8c8d;">Fonte: IBGE - S√©rie 1737</small>
                        </div>
                        
                        <div style="display: flex; gap: 15px; justify-content: center;">
                            <button onclick="applyManualRates()" style="background: #27ae60; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: all 0.3s ease;">
                                ‚úÖ Aplicar
                            </button>
                            <button onclick="this.closest('div').parentElement.remove()" style="background: #95a5a6; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: all 0.3s ease;">
                                ‚ùå Cancelar
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        // Fun√ß√£o para aplicar as taxas manuais
        function applyManualRates() {
            const tlpInput = document.getElementById('manual-tlp');
            const ipcaM1Input = document.getElementById('manual-ipca-m1');
            const ipcaM2Input = document.getElementById('manual-ipca-m2');
            
            const tlpValue = parseFloat(tlpInput.value);
            const ipcaM1Value = parseFloat(ipcaM1Input.value);
            const ipcaM2Value = parseFloat(ipcaM2Input.value);
            
            if (isNaN(tlpValue) || isNaN(ipcaM1Value) || isNaN(ipcaM2Value)) {
                alert('‚ùå Por favor, preencha todos os campos com valores num√©ricos v√°lidos.');
                return;
            }
            
            // Aplicar TLP
            tfdParameters.jm = tlpValue;
            const paramTlpElement = document.getElementById('param-tlp');
            if (paramTlpElement) {
                paramTlpElement.textContent = `${tlpValue.toFixed(2)}% a.a.`;
            }
            
            // Aplicar IPCA
            tfdParameters.ipca_m1 = ipcaM1Value / 100;
            tfdParameters.ipca_m2 = ipcaM2Value / 100;
            
            const ipcaM1Display = document.getElementById('ipca-m1-display');
            const ipcaM2Display = document.getElementById('ipca-m2-display');
            
            if (ipcaM1Display) ipcaM1Display.textContent = `${ipcaM1Value.toFixed(2)}%`;
            if (ipcaM2Display) ipcaM2Display.textContent = `${ipcaM2Value.toFixed(2)}%`;
            
            // Atualizar indicador
            const indicator = document.getElementById('last-update-indicator');
            if (indicator) {
                indicator.innerHTML = `
                    <div style="background: #d4edda; border: 1px solid #c3e6cb; border-radius: 6px; padding: 8px; font-size: 0.8rem; color: #155724;">
                        ‚úÖ <strong>Taxas atualizadas manualmente:</strong> ${new Date().toLocaleString('pt-BR')}
                    </div>
                `;
            }
            
            console.log('‚úÖ Taxas atualizadas com sucesso!');
            console.log(`   TLP: ${tlpValue}% a.a.`);
            console.log(`   IPCA M-1: ${ipcaM1Value}%`);
            console.log(`   IPCA M-2: ${ipcaM2Value}%`);
            
            // Fechar modal
            const modal = document.querySelector('div[style*="position: fixed"]');
            if (modal) modal.remove();
            
            // Mostrar notifica√ß√£o de sucesso
            showSuccessNotification();
        }

        // Fun√ß√£o formatCurrency para exibi√ß√£o
        function formatCurrency(value) {
            if (!value || value === 0) return '0,00';
            return new Intl.NumberFormat('pt-BR', { 
                style: 'currency', 
                currency: 'BRL',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(value);
        }

        // Sistema de formata√ß√£o de moeda para inputs - CORRIGIDO
        function formatCurrencyInput(digits) {
            // Se n√£o h√° d√≠gitos, retornar vazio
            if (!digits || digits === '0' || digits === '00') return '';
            
            // Garantir que √© string de d√≠gitos
            digits = digits.toString().replace(/\D/g, '');
            if (!digits) return '';
            
            // Para valores pequenos, adicionar zeros √† esquerda
            while (digits.length < 3) {
                digits = '0' + digits;
            }
            
            // Separar reais e centavos
            let centavos = digits.slice(-2);
            let reais = digits.slice(0, -2);
            
            // Se reais vazio, √© zero
            if (!reais || reais === '0') {
                reais = '0';
            } else {
                // Remover zeros √† esquerda dos reais
                reais = reais.replace(/^0+/, '') || '0';
                // Adicionar separadores de milhares
                reais = reais.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
            }
            
            return reais + ',' + centavos;
        }

        function parseCurrency(value) {
            if (!value) return 0;
            
            // Extrair apenas d√≠gitos
            let digits = value.toString().replace(/\D/g, '');
            if (!digits) return 0;
            
            // Converter centavos para reais
            return parseInt(digits, 10) / 100;
        }

        function setupCurrencyInput(inputElement) {
            let isUpdating = false;
            
            inputElement.addEventListener('input', function(e) {
                if (isUpdating) return;
                
                isUpdating = true;
                
                // Extrair apenas d√≠gitos
                let digits = this.value.replace(/\D/g, '');
                
                // Aplicar limite m√°ximo (12 d√≠gitos = 999.999.999,99)
                if (digits.length > 12) {
                    digits = digits.substring(0, 12);
                }
                
                // Aplicar formata√ß√£o se h√° d√≠gitos
                if (digits) {
                    this.value = formatCurrencyInput(digits);
                } else {
                    this.value = '';
                }
                
                isUpdating = false;
                
                // Executar valida√ß√µes
                setTimeout(() => {
                    triggerValidations();
                }, 10);
            });
            
            // Permitir apenas n√∫meros e teclas de controle
            inputElement.addEventListener('keydown', function(e) {
                // Permitir: backspace, delete, tab, escape, enter
                if ([8, 9, 27, 13, 46].indexOf(e.keyCode) !== -1 ||
                    // Permitir: Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X
                    (e.keyCode === 65 && e.ctrlKey === true) ||
                    (e.keyCode === 67 && e.ctrlKey === true) ||
                    (e.keyCode === 86 && e.ctrlKey === true) ||
                    (e.keyCode === 88 && e.ctrlKey === true) ||
                    // Permitir: home, end, left, right
                    (e.keyCode >= 35 && e.keyCode <= 39)) {
                    return;
                }
                // Permitir apenas n√∫meros
                if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                    e.preventDefault();
                }
            });
            
            inputElement.addEventListener('focus', function() {
                if (this.value === '0,00') {
                    this.value = '';
                }
            });
            
            inputElement.addEventListener('blur', function() {
                if (!this.value || this.value.replace(/\D/g, '') === '') {
                    this.value = '0,00';
                }
            });
        }

        function triggerValidations() {
            validateFixedInvestment();
            validateMinimumTotalInvestment();
            validateOwnResources();
        }

        // Fun√ß√£o para validar se pode calcular (bloquear se valor insuficiente)
        function canCalculate() {
            const totalInvestment = parseInputValue(document.getElementById('totalInvestment').value) || 0;
            const state = document.getElementById('state').value;
            const municipality = document.getElementById('municipality').value;
            const projectSector = document.getElementById('projectSector').value;
            
            if (!state || !municipality || !projectSector || !totalInvestment) {
                return { canProceed: false, message: '‚ö†Ô∏è Por favor, preencha todos os campos obrigat√≥rios.' };
            }
            
            const municipalityInfo = getMunicipalityInfo(state, municipality);
            if (!municipalityInfo) {
                return { canProceed: false, message: `‚ùå Munic√≠pio "${municipality}" n√£o encontrado no estado ${state}.` };
            }
            
            const isPrioritaria = municipalityInfo.prioridade_espacial === 'PRIORIT√ÅRIA';
            const isHealthSector = projectSector === 'servicos_hospitalares_II';
            const isPrioritariaAltaRenda = isPrioritaria && municipiosPrioritariosAltaRenda.includes(municipality.toUpperCase());
            
            // Determinar valor m√≠nimo
            let minimoInvestimento;
            let justificativa;
            
            if (isHealthSector) {
                minimoInvestimento = 15000000;
                justificativa = 'Servi√ßos Hospitalares (exce√ß√£o para qualquer tipologia)';
            } else if (isPrioritariaAltaRenda) {
                minimoInvestimento = 20000000;
                justificativa = 'Munic√≠pio PRIORIT√ÅRIO de Alta Renda';
            } else if (isPrioritaria) {
                minimoInvestimento = 15000000;
                justificativa = 'Munic√≠pio PRIORIT√ÅRIO (Baixa/M√©dia Renda)';
            } else {
                minimoInvestimento = 20000000;
                justificativa = 'Munic√≠pio DEMAIS';
            }
            
            if (totalInvestment < minimoInvestimento) {
                const valorMinimo = formatCurrency(minimoInvestimento);
                const valorAtual = formatCurrency(totalInvestment);
                return { 
                    canProceed: false, 
                    message: `‚ùå Valor insuficiente! M√≠nimo: ${valorMinimo} (${justificativa}). Atual: ${valorAtual}`
                };
            }
            
            return { canProceed: true, message: '' };
        }

        function parseInputValue(inputValue) {
            if (!inputValue) return 0;
            // Extrair d√≠gitos e converter para valor correto em reais
            let digits = inputValue.replace(/\D/g, '');
            if (!digits) return 0;
            
            // Se tem menos de 3 d√≠gitos, adicionar zeros para formar centavos
            while (digits.length < 3) {
                digits = '0' + digits;
            }
            
            // Converter centavos para reais (valor real j√° considerando os centavos)
            return parseInt(digits, 10) / 100;
        }

        function showApprovalStatus(needsApproval, fdcoAmount, tfdRate) {
            const statusDiv = document.getElementById('approvalStatus');
            
            if (needsApproval) {
                statusDiv.style.display = 'block';
                statusDiv.className = 'alert alert-warning';
                statusDiv.innerHTML = `
                    <i class="fas fa-exclamation-triangle"></i> 
                    <strong>‚ö†Ô∏è DELIBERA√á√ÉO DIRETORIA COLEGIADA √â NECESS√ÅRIA !</strong><br>
                    O valor do financiamento FDCO (${formatCurrency(fdcoAmount)}) supera o limite anual padr√£o de ${formatCurrency(standardLimit)} por Grupo Empresarial, conforme Resolu√ß√£o CONDEL/SUDECO 144/2023. Este projeto requer aprova√ß√£o da DIRETORIA COLEGIADA.<br>
                    Taxa TFD: ${tfdRate.toFixed(2)}% a.a.
                `;
            } else {
                statusDiv.style.display = 'block';
                statusDiv.className = 'alert alert-success';
                statusDiv.innerHTML = `
                    <i class="fas fa-check-circle"></i> 
                    <strong>‚úÖ APROVA√á√ÉO AUTOM√ÅTICA</strong><br>
                    O valor do financiamento FDCO (${formatCurrency(fdcoAmount)}) est√° dentro do limite anual padr√£o de ${formatCurrency(standardLimit)} por Grupo Empresarial, conforme Resolu√ß√£o CONDEL/SUDECO 144/2023.<br>
                    Este projeto pode seguir o fluxo normal de an√°lise da SUDECO.<br>
                    Taxa TFD: ${tfdRate.toFixed(2)}% a.a.
                `;
            }
        }

        function showAlert(type, message) {
            // Fun√ß√£o simplificada apenas para mensagens de valida√ß√£o
            console.log(`${type.toUpperCase()}: ${message}`);
        }

        // Toggle dos par√¢metros
        function toggleParameters() {
            const content = document.getElementById('parametersContent');
            const toggle = document.getElementById('parametersToggle');
            
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                toggle.classList.remove('expanded');
            } else {
                content.classList.add('expanded');
                toggle.classList.add('expanded');
            }
        }

        // Atualizar munic√≠pios baseado no estado
        function updateMunicipalities() {
            const state = document.getElementById('state').value;
            const municipalitySelect = document.getElementById('municipality');
            
            municipalitySelect.innerHTML = '<option value="">Selecione o munic√≠pio</option>';
            
            if (state && municipalityData[state]) {
                const sortedMunicipalities = [...municipalityData[state]].sort((a, b) => a.name.localeCompare(b.name));
                
                sortedMunicipalities.forEach(city => {
                    const option = document.createElement('option');
                    option.value = city.name;
                    const classificacao = city.prioridade_espacial === 'PRIORIT√ÅRIA' ? 'PRIORIT√ÅRIA' : 'DEMAIS';
                    option.textContent = `${city.name} (${classificacao})`;
                    municipalitySelect.appendChild(option);
                });
            }
            validateFixedInvestment();
        }

        // Atualizar op√ß√µes de prazo baseado no setor
        function updateLoanTermOptions() {
            const projectSector = document.getElementById('projectSector').value;
            const loanTermSelect = document.getElementById('loanTerm');
            
            const currentValue = loanTermSelect.value;
            loanTermSelect.innerHTML = '<option value="">Selecione o prazo</option>';
            
            // Infraestrutura tem prazo at√© 20 anos, demais setores at√© 12 anos
            const isInfrastructure = projectSector.startsWith('infraestrutura_');
            const maxYears = isInfrastructure ? 20 : 12;
            
            const availableTerms = [5, 8, 10, 12, 15, 20];
            availableTerms.forEach(years => {
                if (years <= maxYears) {
                    const option = document.createElement('option');
                    option.value = years;
                    option.textContent = `${years} anos`;
                    loanTermSelect.appendChild(option);
                }
            });
            
            if (currentValue && parseInt(currentValue) <= maxYears) {
                loanTermSelect.value = currentValue;
            }
        }

        // Validar recursos pr√≥prios m√≠nimos
        function validateOwnResources() {
            const ownResourcesPerc = parseFloat(document.getElementById('ownResources').value) || 20;
            const totalInvestment = parseInputValue(document.getElementById('totalInvestment').value) || 0;
            const fixedInvestment = parseInputValue(document.getElementById('fixedInvestment').value) || 0;
            const state = document.getElementById('state').value;
            const municipality = document.getElementById('municipality').value;
            const projectSector = document.getElementById('projectSector').value;
            const hintElement = document.getElementById('ownResourcesHint');
            
            if (!hintElement) return;
            
            if (ownResourcesPerc < 20) {
                hintElement.innerHTML = '‚ùå <strong>M√≠nimo 20%</strong> do investimento total';
                hintElement.style.color = '#e74c3c';
                return;
            }
            
            if (!totalInvestment) {
                hintElement.innerHTML = 'üí° <strong>M√≠nimo 20%</strong> do investimento total';
                hintElement.style.color = '#7f8c8d';
                return;
            }
            
            const ownResourcesAmount = totalInvestment * (ownResourcesPerc / 100);
            
            // Calcular o impacto nos limites do FDCO
            if (state && municipality && projectSector && fixedInvestment) {
                const limits = calculateLimits(totalInvestment, projectSector, state, municipality, ownResourcesPerc, fixedInvestment);
                
                if (limits) {
                    const fdcoAvailable = limits.fdcoAmount;
                    const totalUpdatedInvestment = ownResourcesAmount + fdcoAvailable;
                    
                    // Verificar se precisa de aprova√ß√£o do CONDEL - SEM mostrar na valida√ß√£o
                    const needsApproval = fdcoAvailable > standardLimit;
                    
                    hintElement.innerHTML = `‚úÖ <strong>${ownResourcesPerc}%</strong> = ${formatCurrency(ownResourcesAmount)}<br>üí∞ <strong>FDCO dispon√≠vel:</strong> ${formatCurrency(fdcoAvailable)}<br>üìä <strong>Valor Total Atualizado do Investimento = Recursos Pr√≥prios e Terceiros + FDCO dispon√≠vel =</strong> ${formatCurrency(ownResourcesAmount)} + ${formatCurrency(fdcoAvailable)} = ${formatCurrency(totalUpdatedInvestment)}`;
                    hintElement.style.color = needsApproval ? '#856404' : '#27ae60';
                } else {
                    hintElement.innerHTML = `‚úÖ <strong>${ownResourcesPerc}%</strong> = ${formatCurrency(ownResourcesAmount)}`;
                    hintElement.style.color = '#27ae60';
                }
            } else {
                hintElement.innerHTML = `‚úÖ <strong>${ownResourcesPerc}%</strong> = ${formatCurrency(ownResourcesAmount)}`;
                hintElement.style.color = '#27ae60';
            }
        }

        // Lista de munic√≠pios PRIORIT√ÅRIOS de Alta Renda (m√≠nimo R$ 20 milh√µes, exceto servi√ßos hospitalares)
        const municipiosPrioritariosAltaRenda = [
            "AN√ÅPOLIS", "GOI√ÅS", "JATA√ç",
            "CAMPOS DE J√öLIO", "COMODORO", "NOSSA SENHORA DO LIVRAMENTO", "NOVA OL√çMPIA", 
            "PORTO ESTRELA", "RONDON√ìPOLIS", "SAPEZAL", "SINOP", "SORRISO", "TANGAR√Å DA SERRA",
            "AMAMBAI", "ANT√îNIO JO√ÉO", "ARAL MOREIRA", "CAARAP√ì", "DOURADINA", "DOURADOS", 
            "F√ÅTIMA DO SUL", "ITAPOR√É", "JUTI", "LAGUNA CARAP√É", "MARACAJU", 
            "NOVA ALVORADA DO SUL", "PONTA POR√É", "RIO BRILHANTE", "SIDROL√ÇNDIA", 
            "TR√äS LAGOAS", "VICENTINA"
        ];

        // Validar investimento total m√≠nimo - CORRIGIDA
        function validateMinimumTotalInvestment() {
            const totalInvestment = parseInputValue(document.getElementById('totalInvestment').value) || 0;
            const state = document.getElementById('state').value;
            const municipality = document.getElementById('municipality').value;
            const projectSector = document.getElementById('projectSector').value;
            const hintElement = document.getElementById('totalInvestmentHint');
            
            if (!hintElement) return;
            
            // Limpar classes primeiro
            const formGroup = document.getElementById('totalInvestment').closest('.form-group');
            if (formGroup) {
                formGroup.classList.remove('error', 'success');
            }
            
            if (!state || !municipality || !projectSector) {
                hintElement.innerHTML = 'üí° <strong>Valor m√≠nimo:</strong> R$ 15-20 milh√µes conforme munic√≠pio e setor';
                hintElement.style.color = '#7f8c8d';
                return;
            }
            
            const municipalityInfo = getMunicipalityInfo(state, municipality);
            const isPrioritaria = municipalityInfo?.prioridade_espacial === 'PRIORIT√ÅRIA';
            const isHealthSector = projectSector === 'servicos_hospitalares_II';
            const isPrioritariaAltaRenda = isPrioritaria && municipiosPrioritariosAltaRenda.includes(municipality.toUpperCase());
            
            // L√≥gica de valida√ß√£o
            let minimoInvestimento;
            let justificativa;
            
            if (isHealthSector) {
                minimoInvestimento = 15000000;
                justificativa = 'Servi√ßos Hospitalares (exce√ß√£o para qualquer tipologia)';
            } else if (isPrioritariaAltaRenda) {
                minimoInvestimento = 20000000;
                justificativa = 'Munic√≠pio PRIORIT√ÅRIO de Alta Renda';
            } else if (isPrioritaria) {
                minimoInvestimento = 15000000;
                justificativa = 'Munic√≠pio PRIORIT√ÅRIO (Baixa/M√©dia Renda)';
            } else {
                minimoInvestimento = 20000000;
                justificativa = 'Munic√≠pio DEMAIS';
            }
            
            const observacao = (minimoInvestimento === 15000000) ? 
                `<br><br>üìã <strong>Observa√ß√£o:</strong> R$ 15 milh√µes aplic√°vel para:<br>‚Ä¢ Empreendimentos situados em munic√≠pios classificados pela tipologia da PNDR, como de baixa e m√©dia renda, independente do seu dinamismo;<br>‚Ä¢ Investimentos em servi√ßos hospitalares e ambulatoriais, independentemente da classifica√ß√£o da Tipologia do munic√≠pio definido pela PNDR` : '';
            
            const valorMinimo = formatCurrency(minimoInvestimento);
            
            if (!totalInvestment) {
                hintElement.innerHTML = `üí° <strong>Valor m√≠nimo:</strong> ${valorMinimo} (${justificativa})${observacao}`;
                hintElement.style.color = '#0c5460';
                return;
            }
            
            if (totalInvestment < minimoInvestimento) {
                // MENSAGEM DE ERRO - CR√çTICA
                hintElement.innerHTML = `‚ùå <strong>Insuficiente!</strong> M√≠nimo: ${valorMinimo} (${justificativa})<br>Atual: ${formatCurrency(totalInvestment)}<br><br>üìã <strong>Base Legal:</strong> Resolu√ß√£o CONDEL/SUDECO 135 de 12 de dezembro de 2022, Art. 2¬∫ - ...valor m√≠nimo dos projetos assistidos pelo FDCO em R$ 15.000.000,00 (quinze milh√µes de reais), para empreendimentos situados em munic√≠pios classificados pela tipologia da Pol√≠tica Nacional de Desenvolvimento Regional - PNDR como de baixa e m√©dia renda, independente do seu dinamismo e para investimentos em servi√ßos hospitalares e ambulatoriais, independentemente da classifica√ß√£o da Tipologia do munic√≠pio definido pela PNDR, respeitados os limites de participa√ß√£o dos recursos do Fundo estabelecidos pelo Conselho Monet√°rio Nacional (CMN).`;
                hintElement.style.color = '#721c24';
                
                // Adicionar classe de erro ao form-group
                if (formGroup) {
                    formGroup.classList.add('error');
                }
                return;
            }
            
            // SUCESSO - REMOVER classe de erro se existir
            hintElement.innerHTML = `‚úÖ <strong>Adequado!</strong> M√≠nimo: ${valorMinimo} (${justificativa})<br>Atual: ${formatCurrency(totalInvestment)}${observacao}`;
            hintElement.style.color = '#155724';
            
            // Adicionar classe de sucesso
            if (formGroup) {
                formGroup.classList.add('success');
            }
            
            console.log('‚úÖ Valida√ß√£o de investimento total: APROVADO');
        }

        // Validar investimento fixo
        function validateFixedInvestment() {
            const totalInvestment = parseInputValue(document.getElementById('totalInvestment').value) || 0;
            const fixedInvestment = parseInputValue(document.getElementById('fixedInvestment').value) || 0;
            const state = document.getElementById('state').value;
            const municipality = document.getElementById('municipality').value;
            const projectSector = document.getElementById('projectSector').value;
            const hintElement = document.getElementById('fixedInvestmentHint');
            
            if (!hintElement) return;
            
            if (!state || !municipality || !projectSector) {
                hintElement.innerHTML = 'üí° Selecione todos os campos primeiro para ver os limites';
                hintElement.style.color = '#7f8c8d';
                return;
            }
            
            const municipalityInfo = getMunicipalityInfo(state, municipality);
            const location = municipalityInfo?.prioridade_espacial === 'PRIORIT√ÅRIA' ? 'prioritaria' : 'demais';
            const sectorLimitPerc = sectorLimits[projectSector] ? sectorLimits[projectSector][location] : null;
            
            if (!sectorLimitPerc) {
                hintElement.innerHTML = '‚ö†Ô∏è Setor n√£o encontrado';
                hintElement.style.color = '#856404';
                return;
            }
            
            if (!fixedInvestment) {
                const regionName = location === 'prioritaria' ? 'PRIORIT√ÅRIA' : 'DEMAIS';
                hintElement.innerHTML = `üí° <strong>Limite FDCO:</strong> 90% do investimento fixo (m√°x ${sectorLimitPerc}% do total e 80% financi√°vel)<br>Regi√£o ${regionName}`;
                hintElement.style.color = '#856404';
                return;
            }
            
            const maxBySector = totalInvestment * (sectorLimitPerc / 100);
            const maxByFixedRule = fixedInvestment * 0.9;
            const maxByFinanciable = totalInvestment * 0.8;
            // REMOVER LIMITE DE 50 MILH√ïES
            const fdcoLimit = Math.min(maxBySector, maxByFixedRule, maxByFinanciable);
            
            const regionName2 = location === 'prioritaria' ? 'PRIORIT√ÅRIA' : 'DEMAIS';
            
            // Verificar se precisa de delibera√ß√£o do CONDEL - SEM mostrar aqui
            const needsApproval = fdcoLimit > standardLimit;
            
            hintElement.innerHTML = `‚úÖ <strong>Limite FDCO: ${formatCurrency(fdcoLimit)}</strong><br>‚Ä¢ Setorial (${sectorLimitPerc}% do total): ${formatCurrency(maxBySector)}<br>‚Ä¢ 90% do investimento fixo: ${formatCurrency(maxByFixedRule)}<br>‚Ä¢ 80% financi√°vel do total: ${formatCurrency(maxByFinanciable)}<br>‚Ä¢ Limite padr√£o: ${formatCurrency(standardLimit)}<br>Regi√£o ${regionName2}`;
            hintElement.style.color = needsApproval ? '#856404' : '#155724';
        }

        function getMunicipalityInfo(state, municipalityName) {
            if (!state || !municipalityName || !municipalityData[state]) {
                return null;
            }
            
            return municipalityData[state].find(city => 
                city.name.toUpperCase() === municipalityName.toUpperCase()
            );
        }

        // Calcular FAM com precis√£o otimizada
        function calculateFAM() {
            const { ipca_m1, ipca_m2, ndup, ndus, ndmp, ndms } = tfdParameters;
            // Usar 3 casas decimais nos IPCAs para melhor aproxima√ß√£o com planilha oficial
            const pi_m1 = parseFloat(ipca_m1.toFixed(3));
            const pi_m2 = parseFloat(ipca_m2.toFixed(3));
            const termo1 = Math.pow(1 + pi_m2, ndup / ndmp);
            const termo2 = Math.pow(1 + pi_m1, ndus / ndms);
            const fam = termo1 * termo2;
            return parseFloat(fam.toFixed(9));
        }

        // Calcular TFD
        function calculateTFD(fp) {
            const { jm, alpha, cdr, du } = tfdParameters;
            const jurosPrefixadosTLP = (alpha * jm) / 100;
            const fam = calculateFAM();
            const termo1 = cdr * fp * jurosPrefixadosTLP;
            const termo2 = 1 + termo1;
            const expoente = du / 252;
            const termo3 = Math.pow(termo2, expoente);
            const tfd_mensal = fam * termo3 - 1;
            const tfd_anual = Math.pow(1 + tfd_mensal, 12) - 1;
            return tfd_anual * 100;
        }

        function getFatorPrograma(projectSector, municipalityInfo) {
            if (!projectSector || !municipalityInfo) return null;
            const isPrioritaria = municipalityInfo.prioridade_espacial === 'PRIORIT√ÅRIA';
            
            // INFRAESTRUTURA - SANEAMENTO (FP: A/C)
            if (projectSector === 'infraestrutura_saneamento_III') {
                return isPrioritaria ? 'A' : 'C';
            }
            
            // INFRAESTRUTURA, INFRAESTRUTURA ESTRUTURANTE, SERVI√áOS P√öBLICOS, SERVI√áOS, TRADICIONAIS, CTI (FP: B/D)
            if (projectSector.startsWith('infraestrutura_') ||
                projectSector.startsWith('servicos_') ||
                projectSector.startsWith('tradicionais_') || 
                projectSector.startsWith('cti_')) {
                return isPrioritaria ? 'B' : 'D';
            }
            
            return null;
        }

        function calculateLimits(totalInvestment, projectSector, state, municipality, ownResourcesPerc = 20, fixedInvestment = 0) {
            if (!projectSector || !state || !municipality || !totalInvestment) {
                return null;
            }

            const municipalityInfo = getMunicipalityInfo(state, municipality);
            if (!municipalityInfo) {
                return null;
            }

            const location = municipalityInfo.prioridade_espacial === 'PRIORIT√ÅRIA' ? 'prioritaria' : 'demais';
            const sectorLimitPerc = sectorLimits[projectSector] ? sectorLimits[projectSector][location] : null;
            
            if (!sectorLimitPerc) {
                return null;
            }

            const maxBySector = totalInvestment * (sectorLimitPerc / 100);
            const maxByFixedRule = fixedInvestment * 0.9;
            const maxByFinanciable = totalInvestment * 0.8;
            const maxByOwnResources = totalInvestment * (1 - ownResourcesPerc / 100);
            
            // REMOVER LIMITE DE 50 MILH√ïES - calcular valor real
            let fdcoAmount = Math.min(maxBySector, maxByFixedRule, maxByFinanciable, maxByOwnResources);
            
            if (fixedInvestment > 0 && fixedInvestment < fdcoAmount) {
                fdcoAmount = fixedInvestment;
            }
            
            fdcoAmount = Math.max(0, fdcoAmount);
            
            // Verificar se precisa de delibera√ß√£o do CONDEL
            const needsCondelApproval = fdcoAmount > standardLimit;
            
            return {
                maxBySector,
                maxByFixedRule,
                maxByFinanciable,
                maxByOwnResources,
                standardLimit: standardLimit,
                fdcoAmount,
                sectorLimitPerc,
                location,
                municipalityInfo,
                needsCondelApproval
            };
        }

        function generateSACSchedule(principal, semestralRate, totalYears, gracePeriod) {
            const schedule = [];
            const startDate = new Date();
            let currentDate = new Date(startDate);
            let balance = principal;
            const amortizationPeriods = (totalYears - gracePeriod) * 2;
            const sacAmortization = amortizationPeriods > 0 ? principal / amortizationPeriods : 0;

            // Per√≠odo de car√™ncia
            for (let i = 1; i <= gracePeriod * 2; i++) {
                currentDate.setMonth(currentDate.getMonth() + 6);
                const interest = balance * semestralRate;
                balance += interest;
                
                schedule.push({
                    payment: i,
                    date: new Date(currentDate).toLocaleDateString('pt-BR'),
                    principal: 0, 
                    interest: interest, 
                    total: interest, 
                    balance: balance, 
                    type: 'Car√™ncia'
                });
            }

            // Per√≠odo de amortiza√ß√£o
            balance = principal + (gracePeriod * 2 * principal * semestralRate);
            for (let i = 1; i <= amortizationPeriods; i++) {
                currentDate.setMonth(currentDate.getMonth() + 6);
                const interest = balance * semestralRate;
                const totalPayment = sacAmortization + interest;
                balance -= sacAmortization;

                schedule.push({
                    payment: (gracePeriod * 2) + i,
                    date: new Date(currentDate).toLocaleDateString('pt-BR'),
                    principal: sacAmortization, 
                    interest: interest, 
                    total: totalPayment,
                    balance: Math.max(0, balance), 
                    type: 'SAC'
                });
            }

            return schedule;
        }

        // Fun√ß√£o principal de c√°lculo - CORRIGIDA para resolver bug de rec√°lculo
        function calculateResults() {
            // Primeiro, sempre revalidar tudo para limpar estados antigos
            triggerValidations();
            
            // Dar um pequeno delay para as valida√ß√µes processarem
            setTimeout(() => {
                // Verificar se h√° erros de valida√ß√£o vis√≠veis
                const totalInvestmentGroup = document.getElementById('totalInvestment').closest('.form-group');
                if (totalInvestmentGroup && totalInvestmentGroup.classList.contains('error')) {
                    showValidationErrorInResults();
                    return;
                }
                
                // Segunda valida√ß√£o: verificar se pode calcular (backup)
                const validation = canCalculate();
                if (!validation.canProceed) {
                    showAlert('danger', validation.message);
                    showValidationErrorInResults();
                    return;
                }
                
                const totalInvestment = parseInputValue(document.getElementById('totalInvestment').value) || 0;
                const fixedInvestment = parseInputValue(document.getElementById('fixedInvestment').value) || 0;
                const ownResourcesPerc = parseFloat(document.getElementById('ownResources').value) || 20;
                const projectSector = document.getElementById('projectSector').value;
                const state = document.getElementById('state').value;
                const municipality = document.getElementById('municipality').value;
                const loanTerm = parseInt(document.getElementById('loanTerm').value) || 0;
                const gracePeriod = parseFloat(document.getElementById('gracePeriod').value) || 0;

                const municipalityInfo = getMunicipalityInfo(state, municipality);
                
                if (ownResourcesPerc < 20) {
                    showAlert('danger', '‚ùå Recursos pr√≥prios devem ser no m√≠nimo 20%.');
                    showValidationErrorInResults();
                    return;
                }

                try {
                    const limits = calculateLimits(totalInvestment, projectSector, state, municipality, ownResourcesPerc, fixedInvestment);
                    if (!limits) {
                        showAlert('danger', `‚ùå Erro ao calcular limites para o setor: ${projectSector}`);
                        showValidationErrorInResults();
                        return;
                    }

                    const priority = getFatorPrograma(projectSector, municipalityInfo);
                    if (!priority) {
                        showAlert('danger', `‚ùå Erro ao determinar Fator de Programa para o setor: ${projectSector}`);
                        showValidationErrorInResults();
                        return;
                    }
                    
                    const fp = priorityFactors[priority];
                    const tfdRate = calculateTFD(fp);
                    
                    const fdcoAmount = limits.fdcoAmount;
                    const fdcoPercentage = totalInvestment > 0 ? (fdcoAmount / totalInvestment) * 100 : 0;
                    const ownResourcesAmount = totalInvestment - fdcoAmount;

                    const semestralRate = tfdRate / 100 / 2;
                    const amortizationPeriods = (loanTerm - gracePeriod) * 2;
                    let sacAmortization = 0;
                    let firstPayment = 0;

                    if (amortizationPeriods > 0 && fdcoAmount > 0) {
                        sacAmortization = fdcoAmount / amortizationPeriods;
                        const initialInterest = fdcoAmount * semestralRate;
                        firstPayment = sacAmortization + initialInterest;
                    }

                    const schedule = generateSACSchedule(fdcoAmount, semestralRate, loanTerm, gracePeriod);

                    const results = {
                        fdcoAmount,
                        tfdRate,
                        fp,
                        priority,
                        fdcoPercentage,
                        ownResourcesAmount,
                        sacAmortization,
                        firstPayment,
                        schedule,
                        limits,
                        municipalityInfo,
                        needsCondelApproval: limits.needsCondelApproval
                    };

                    updateResults(results);
                    displaySACSchedule(results.schedule);
                    showApprovalStatus(results.needsCondelApproval, results.fdcoAmount, results.tfdRate);
                    
                    // Mostrar resultados
                    const placeholder = document.getElementById('resultsPlaceholder');
                    if (placeholder) placeholder.style.display = 'none';
                    
                    document.getElementById('simulationResults').style.display = 'block';
                    
                    // Scroll suave para resultados
                    setTimeout(() => {
                        const resultsSection = document.querySelector('.results-panel-fullwidth');
                        if (resultsSection) {
                            resultsSection.scrollIntoView({ 
                                behavior: 'smooth', 
                                block: 'start' 
                            });
                        }
                    }, 100);

                } catch (error) {
                    console.error('Erro no c√°lculo:', error);
                    showAlert('danger', `‚ùå Erro no c√°lculo: ${error.message}`);
                    showValidationErrorInResults();
                }
            }, 50); // Pequeno delay para processar valida√ß√µes
        }

        // Fun√ß√£o para mostrar erro de valida√ß√£o no painel de resultados
        function showValidationErrorInResults() {
            const placeholder = document.getElementById('resultsPlaceholder');
            const simulationResults = document.getElementById('simulationResults');
            
            // Esconder resultados se existirem
            if (simulationResults) simulationResults.style.display = 'none';
            
            // Mostrar mensagem de erro no placeholder
            if (placeholder) {
                placeholder.style.display = 'block';
                placeholder.innerHTML = `
                    <div class="results-placeholder">
                        <div class="placeholder-content">
                            <div class="placeholder-icon" style="color: #e74c3c;">
                                ‚ùå
                            </div>
                            <h2 class="results-title-full" style="color: #e74c3c;">Erro de Valida√ß√£o</h2>
                            <div class="placeholder-message">
                                <div style="background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 8px; padding: 20px; margin: 20px 0; color: #721c24;">
                                    <div style="font-size: 1.1rem; font-weight: 600; margin-bottom: 10px;">
                                        ‚ö†Ô∏è N√£o √© poss√≠vel calcular o financiamento FDCO
                                    </div>
                                    <div style="font-size: 1rem; line-height: 1.4;">
                                        H√° erros nos campos obrigat√≥rios que devem ser corrigidos antes do c√°lculo.
                                        <br><br>
                                        <strong>Verifique especialmente:</strong>
                                        <br>‚Ä¢ <strong>Investimento Total:</strong> Valor m√≠nimo conforme munic√≠pio e setor
                                        <br>‚Ä¢ <strong>Investimento Fixo:</strong> Deve estar preenchido
                                        <br>‚Ä¢ <strong>Recursos Pr√≥prios:</strong> M√≠nimo 20%
                                        <br>‚Ä¢ <strong>Todos os campos obrigat√≥rios (*):</strong> Devem estar preenchidos
                                    </div>
                                </div>
                                <div style="text-align: center; margin-top: 20px;">
                                    <button onclick="scrollToFirstError()" style="background: #3498db; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer;">
                                        üìç Ir para o primeiro erro
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // Fun√ß√£o para rolar at√© o primeiro erro
        function scrollToFirstError() {
            const errorGroup = document.querySelector('.form-group.error');
            if (errorGroup) {
                errorGroup.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });
                
                // Destacar o campo com erro temporariamente
                errorGroup.style.backgroundColor = '#fff3cd';
                setTimeout(() => {
                    errorGroup.style.backgroundColor = '';
                }, 2000);
            }
        }

        function updateResults(data) {
            document.getElementById('fdcoLoanAmount').textContent = formatCurrency(data.fdcoAmount);
            document.getElementById('tfdRate').textContent = `${data.tfdRate.toFixed(2)}% a.a.`;
            document.getElementById('fpValue').textContent = `${data.priority} (${data.fp.toFixed(2)})`;
            document.getElementById('fdcoPercentage').textContent = `${data.fdcoPercentage.toFixed(1)}%`;
            document.getElementById('ownResourcesAmount').textContent = formatCurrency(data.ownResourcesAmount);
            document.getElementById('sacAmortization').textContent = formatCurrency(data.sacAmortization);
            document.getElementById('firstPayment').textContent = formatCurrency(data.firstPayment);
            
            // Destacar a informa√ß√£o do CONDEL se aplic√°vel
            const condelInfo = document.getElementById('condelApprovalInfo');
            if (condelInfo) {
                if (data.needsCondelApproval) {
                    condelInfo.style.background = '#fff3cd';
                    condelInfo.style.borderColor = '#ffc107';
                    condelInfo.querySelector('strong').style.color = '#856404';
                    condelInfo.querySelector('div').style.color = '#856404';
                } else {
                    condelInfo.style.background = '#e7f3ff';
                    condelInfo.style.borderColor = '#2196f3';
                    condelInfo.querySelector('strong').style.color = '#1976d2';
                    condelInfo.querySelector('div').style.color = '#1976d2';
                }
            }
        }

        function displaySACSchedule(schedule) {
            let totalPrincipal = 0;
            let totalInterest = 0;
            let totalPayments = 0;
            
            // Calcular totais
            schedule.forEach(row => {
                totalPrincipal += row.principal;
                totalInterest += row.interest;
                totalPayments += row.total;
            });
            
            let html = `
                <div style="margin-bottom: 20px; padding: 15px; background: #e7f3ff; border-radius: 8px; border-left: 4px solid #2196f3;">
                    <h4 style="margin: 0 0 10px 0; color: #1976d2;">üìä Resumo do Financiamento SAC</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div><strong>Total de Parcelas:</strong> ${schedule.length}</div>
                        <div><strong>Principal Total:</strong> ${formatCurrency(totalPrincipal)}</div>
                        <div><strong>Juros Totais:</strong> ${formatCurrency(totalInterest)}</div>
                        <div><strong>Montante Total Pago:</strong> ${formatCurrency(totalPayments)}</div>
                    </div>
                </div>
                
                <div style="max-height: 400px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead style="position: sticky; top: 0; background: #2c3e50; z-index: 10;">
                            <tr>
                                <th style="padding: 12px 8px; color: white; text-align: center; font-weight: 600;">Parc.</th>
                                <th style="padding: 12px 8px; color: white; text-align: center; font-weight: 600;">Data</th>
                                <th style="padding: 12px 8px; color: white; text-align: center; font-weight: 600;">Tipo</th>
                                <th style="padding: 12px 8px; color: white; text-align: center; font-weight: 600;">Principal</th>
                                <th style="padding: 12px 8px; color: white; text-align: center; font-weight: 600;">Juros</th>
                                <th style="padding: 12px 8px; color: white; text-align: center; font-weight: 600;">Total</th>
                                <th style="padding: 12px 8px; color: white; text-align: center; font-weight: 600;">Saldo</th>
                            </tr>
                        </thead>
                        <tbody>`;
            
            schedule.forEach((row, index) => {
                const cssClass = row.type === 'Car√™ncia' ? 'grace-period' : '';
                const isLastRow = index === schedule.length - 1;
                const rowStyle = isLastRow ? 'background: #d4edda; font-weight: 600;' : '';
                
                html += `<tr class="${cssClass}" style="${rowStyle}">
                    <td style="padding: 10px 8px; text-align: center; border-bottom: 1px solid #ecf0f1;">${row.payment}</td>
                    <td style="padding: 10px 8px; text-align: center; border-bottom: 1px solid #ecf0f1;">${row.date}</td>
                    <td style="padding: 10px 8px; text-align: center; border-bottom: 1px solid #ecf0f1;">
                        ${row.type === 'Car√™ncia' ? '‚è∏Ô∏è Car√™ncia' : 'üí∞ SAC'}
                    </td>
                    <td style="padding: 10px 8px; text-align: right; border-bottom: 1px solid #ecf0f1;">${formatCurrency(row.principal)}</td>
                    <td style="padding: 10px 8px; text-align: right; border-bottom: 1px solid #ecf0f1;">${formatCurrency(row.interest)}</td>
                    <td style="padding: 10px 8px; text-align: right; border-bottom: 1px solid #ecf0f1; font-weight: 600;">${formatCurrency(row.total)}</td>
                    <td style="padding: 10px 8px; text-align: right; border-bottom: 1px solid #ecf0f1; ${isLastRow ? 'color: #28a745; font-weight: 700;' : ''}">${formatCurrency(row.balance)}</td>
                </tr>`;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
                
                <div style="margin-top: 15px; padding: 12px; background: #f8f9fa; border-radius: 8px; font-size: 0.9rem; color: #6c757d;">
                    <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <div style="width: 16px; height: 16px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 3px;"></div>
                            <span>Per√≠odo de Car√™ncia</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <div style="width: 16px; height: 16px; background: #d4edda; border: 1px solid #28a745; border-radius: 3px;"></div>
                            <span>Saldo Final</span>
                        </div>
                        <div><strong>Observa√ß√£o:</strong> Valores calculados no Sistema SAC (Sistema de Amortiza√ß√£o Constante)</div>
                    </div>
                </div>`;
            
            document.getElementById('paymentSchedule').innerHTML = html;
        }

        function showMunicipalityStats() {
            const stats = {
                DF: municipalityData['DF'].length,
                GO: municipalityData['GO'].length,
                MT: municipalityData['MT'].length,
                MS: municipalityData['MS'].length
            };
            
            const total = stats.DF + stats.GO + stats.MT + stats.MS;
            
            let prioritarias = 0;
            let demais = 0;
            let altaRenda = 0;
            let mediaBaixaRenda = 0;
            
            Object.values(municipalityData).forEach(stateData => {
                stateData.forEach(city => {
                    if (city.prioridade_espacial === 'PRIORIT√ÅRIA') {
                        prioritarias++;
                        // Verificar se √© de Alta Renda
                        if (municipiosPrioritariosAltaRenda.includes(city.name.toUpperCase())) {
                            altaRenda++;
                        } else {
                            mediaBaixaRenda++;
                        }
                    } else {
                        demais++;
                        // Todos os DEMAIS s√£o considerados Alta Renda para o limite de R$ 20 mi
                        altaRenda++;
                    }
                });
            });
            
            // Criar modal para mostrar as estat√≠sticas
            const modalHTML = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 15px; padding: 30px; max-width: 600px; width: 90%; max-height: 80%; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                        <div style="text-align: center; margin-bottom: 25px;">
                            <h2 style="color: #2c3e50; margin-bottom: 10px;">üìä ESTAT√çSTICAS DOS MUNIC√çPIOS FDCO</h2>
                            <p style="color: #7f8c8d;">Superintend√™ncia do Desenvolvimento do Centro-Oeste</p>
                        </div>
                        
                        <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                            <h3 style="color: #2c3e50; margin-bottom: 15px;">üìç Munic√≠pios por Estado</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div>‚Ä¢ <strong>Distrito Federal:</strong> ${stats.DF} munic√≠pio</div>
                                <div>‚Ä¢ <strong>Goi√°s:</strong> ${stats.GO} munic√≠pios</div>
                                <div>‚Ä¢ <strong>Mato Grosso:</strong> ${stats.MT} munic√≠pios</div>
                                <div>‚Ä¢ <strong>Mato Grosso do Sul:</strong> ${stats.MS} munic√≠pios</div>
                            </div>
                            <div style="text-align: center; margin-top: 15px; font-size: 1.2rem; font-weight: bold; color: #27ae60;">
                                üèÜ Total: ${total} munic√≠pios
                            </div>
                        </div>
                        
                        <div style="background: #e8f5e8; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                            <h3 style="color: #2c3e50; margin-bottom: 15px;">üéØ Classifica√ß√£o por Prioridade Espacial</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div>‚Ä¢ <strong>PRIORIT√ÅRIOS:</strong> ${prioritarias} munic√≠pios</div>
                                <div>‚Ä¢ <strong>DEMAIS:</strong> ${demais} munic√≠pios</div>
                            </div>
                        </div>
                        
                        <div style="background: #fff3cd; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                            <h3 style="color: #2c3e50; margin-bottom: 15px;">üí∞ Classifica√ß√£o por Renda (para limites m√≠nimos)</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div>‚Ä¢ <strong>Alta Renda:</strong> ${altaRenda} munic√≠pios<br><small style="color: #856404;">(Limite: R$ 20 milh√µes)</small></div>
                                <div>‚Ä¢ <strong>M√©dia/Baixa Renda:</strong> ${mediaBaixaRenda} munic√≠pios<br><small style="color: #856404;">(Limite: R$ 15 milh√µes)</small></div>
                            </div>
                            <div style="margin-top: 10px; font-size: 0.9rem; color: #856404;">
                                <strong>Exce√ß√£o:</strong> Servi√ßos Hospitalares sempre R$ 15 milh√µes (qualquer tipologia)
                            </div>
                        </div>
                        
                        <div style="background: #d1ecf1; border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                            <div style="font-size: 0.9rem; color: #0c5460;">
                                üéâ <strong>Status:</strong> Base Completa - Todos os Munic√≠pios Inclu√≠dos
                            </div>
                        </div>
                        
                        <div style="text-align: center;">
                            <button onclick="this.closest('div').parentElement.remove()" style="background: #3498db; color: white; border: none; padding: 12px 30px; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: all 0.3s ease;">
                                ‚úÖ Fechar
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Adicionar modal ao corpo da p√°gina
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        function clearForm() {
            document.getElementById('simulatorForm').reset();
            document.getElementById('simulationResults').style.display = 'none';
            document.getElementById('municipality').innerHTML = '<option value="">Primeiro selecione o estado</option>';
            document.getElementById('ownResources').value = '20';
            document.getElementById('totalInvestment').value = '20000000';
            document.getElementById('fixedInvestment').value = '16000000';
            
            // Mostrar placeholder novamente
            const placeholder = document.getElementById('resultsPlaceholder');
            if (placeholder) placeholder.style.display = 'block';
            
            // Esconder o status de aprova√ß√£o
            const statusDiv = document.getElementById('approvalStatus');
            if (statusDiv) statusDiv.style.display = 'none';
        }

        // Event listeners reescritos - CORRIGIDOS para trigger na digita√ß√£o
        document.getElementById('state').addEventListener('change', () => {
            updateMunicipalities();
            triggerValidations();
        });
        
        document.getElementById('municipality').addEventListener('change', () => {
            triggerValidations();
        });
        
        document.getElementById('projectSector').addEventListener('change', () => {
            updateLoanTermOptions();
            triggerValidations();
        });
        
        // ADICIONAR event listener para campo totalInvestment - CR√çTICO
        document.getElementById('totalInvestment').addEventListener('input', () => {
            triggerValidations();
        });
        
        document.getElementById('ownResources').addEventListener('input', validateOwnResources);

        // Inicializa√ß√£o simplificada para teste - REMOVIDA (movida para cima)
        // document.addEventListener('DOMContentLoaded', function() {
        //     // Configurar inputs de moeda
        //     setupCurrencyInput(document.getElementById('totalInvestment'));
        //     setupCurrencyInput(document.getElementById('fixedInvestment'));
        //     
        //     // Valores iniciais para teste (sem formata√ß√£o inicial)
        //     document.getElementById('totalInvestment').value = '';
        //     document.getElementById('fixedInvestment').value = '';
        //     
        //     validateMinimumTotalInvestment();
        //     validateOwnResources();
        // });
    </script>
</body>
</html>